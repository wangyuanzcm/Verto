# Vertoé¡¹ç›®é›†æˆæŒ‡å—

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

Vertoæ˜¯ä¸€ä¸ªåŸºäºJeecgBootæ¡†æ¶çš„ä¼ä¸šçº§åº”ç”¨å¼€å‘å¹³å°ï¼Œé›†æˆäº†å®Œæ•´çš„DevOpså·¥å…·é“¾ï¼ŒåŒ…æ‹¬GitLabä»£ç ç®¡ç†å’ŒJenkinsæŒç»­é›†æˆã€‚

### æŠ€æœ¯æ ˆ
- **å‰ç«¯**: Vue3 + Vite + TypeScript + Ant Design Vue
- **åç«¯**: Spring Boot + MyBatis Plus + MySQL + Redis
- **DevOps**: GitLab + Jenkins + Docker + Docker Compose

## ğŸš€ å¿«é€Ÿé›†æˆæ­¥éª¤

### 1. ç¯å¢ƒå‡†å¤‡

#### ç³»ç»Ÿè¦æ±‚
```bash
# Windows 10/11 æˆ– Windows Server 2019+
# Docker Desktop 4.0+
# Git 2.30+
# è‡³å°‘ 8GB RAMï¼Œæ¨è 16GB
# è‡³å°‘ 50GB å¯ç”¨ç£ç›˜ç©ºé—´
```

#### å®‰è£…ä¾èµ–
```powershell
# å®‰è£… Docker Desktop
# ä¸‹è½½åœ°å€: https://www.docker.com/products/docker-desktop

# éªŒè¯å®‰è£…
docker --version
docker-compose --version

# å®‰è£… Git
# ä¸‹è½½åœ°å€: https://git-scm.com/download/win

# éªŒè¯å®‰è£…
git --version
```

### 2. é¡¹ç›®åˆå§‹åŒ–

#### å…‹éš†é¡¹ç›®
```bash
# å…‹éš†ä¸»é¡¹ç›®
git clone https://github.com/your-org/verto.git
cd verto

# åˆå§‹åŒ–å­æ¨¡å—ï¼ˆå¦‚æœæœ‰ï¼‰
git submodule update --init --recursive
```

#### é…ç½®ç¯å¢ƒå˜é‡
```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
copy .env.example .env.devops

# ç¼–è¾‘ç¯å¢ƒå˜é‡
notepad .env.devops
```

### 3. DevOpsç¯å¢ƒå¯åŠ¨

#### å¯åŠ¨GitLabå’ŒJenkins
```bash
# å¯åŠ¨DevOpsæœåŠ¡
.\start-devops.bat

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
.\devops-status.bat

# æŸ¥çœ‹æœåŠ¡æ—¥å¿—
docker-compose -f docker-compose-devops.yml logs -f
```

#### è®¿é—®æœåŠ¡
- **GitLab**: http://localhost:8080
  - é»˜è®¤ç”¨æˆ·: root
  - å¯†ç : æŸ¥çœ‹å®¹å™¨æ—¥å¿—è·å–åˆå§‹å¯†ç 
- **Jenkins**: http://localhost:8081
  - åˆå§‹å¯†ç : æŸ¥çœ‹å®¹å™¨æ—¥å¿—æˆ–æ–‡ä»¶

### 4. é¡¹ç›®é…ç½®

#### GitLabé¡¹ç›®è®¾ç½®
```bash
# 1. åˆ›å»ºæ–°é¡¹ç›®
# ç™»å½•GitLab -> New Project -> Create blank project
# é¡¹ç›®å: verto
# å¯è§æ€§: Private

# 2. æ·»åŠ è¿œç¨‹ä»“åº“
git remote add gitlab http://localhost:8080/root/verto.git

# 3. æ¨é€ä»£ç 
git push gitlab main
```

#### Jenkinsä»»åŠ¡é…ç½®
```groovy
// 1. åˆ›å»ºPipelineä»»åŠ¡
// Jenkins -> New Item -> Pipeline -> verto-pipeline

// 2. é…ç½®Pipelineè„šæœ¬
pipeline {
    agent any
    
    stages {
        stage('æ£€å‡ºä»£ç ') {
            steps {
                git branch: 'main', url: 'http://gitlab:8080/root/verto.git'
            }
        }
        
        stage('å‰ç«¯æ„å»º') {
            steps {
                dir('jeecgboot-vue3') {
                    bat 'npm install -g pnpm'
                    bat 'pnpm install'
                    bat 'pnpm build'
                }
            }
        }
        
        stage('åç«¯æ„å»º') {
            steps {
                dir('jeecg-boot') {
                    bat 'mvn clean package -DskipTests'
                }
            }
        }
    }
}
```

## ğŸ”§ å¼€å‘ç¯å¢ƒé›†æˆ

### 1. å‰ç«¯å¼€å‘ç¯å¢ƒ

#### å®‰è£…ä¾èµ–
```bash
cd jeecgboot-vue3

# å®‰è£…pnpmï¼ˆå¦‚æœæœªå®‰è£…ï¼‰
npm install -g pnpm

# å®‰è£…é¡¹ç›®ä¾èµ–
pnpm install
```

#### å¼€å‘æœåŠ¡å™¨
```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
pnpm dev

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
pnpm build

# è¿è¡Œæµ‹è¯•
pnpm test

# ä»£ç æ£€æŸ¥
pnpm lint
```

#### ç¯å¢ƒé…ç½®
```typescript
// jeecgboot-vue3/.env.development
VITE_APP_API_BASE_URL=http://localhost:8080
VITE_APP_UPLOAD_URL=http://localhost:8080/sys/common/upload
VITE_APP_WEBSOCKET_URL=ws://localhost:8080/websocket

// jeecgboot-vue3/.env.production
VITE_APP_API_BASE_URL=https://api.verto.com
VITE_APP_UPLOAD_URL=https://api.verto.com/sys/common/upload
VITE_APP_WEBSOCKET_URL=wss://api.verto.com/websocket
```

### 2. åç«¯å¼€å‘ç¯å¢ƒ

#### æ•°æ®åº“é…ç½®
```yaml
# jeecg-boot/jeecg-system-start/src/main/resources/application-dev.yml
spring:
  datasource:
    dynamic:
      primary: master
      datasource:
        master:
          url: jdbc:mysql://localhost:3306/verto?useUnicode=true&characterEncoding=utf8&zeroDateTimeBehavior=convertToNull&useSSL=false&serverTimezone=GMT%2B8
          username: root
          password: root123
          driver-class-name: com.mysql.cj.jdbc.Driver
  
  redis:
    host: localhost
    port: 6379
    password: 
    database: 0
    timeout: 3000ms
    lettuce:
      pool:
        max-active: 8
        max-wait: -1ms
        max-idle: 8
        min-idle: 0
```

#### å¯åŠ¨åç«¯æœåŠ¡
```bash
cd jeecg-boot

# ä½¿ç”¨Mavenå¯åŠ¨
mvn spring-boot:run -pl jeecg-module-system/jeecg-system-start

# æˆ–è€…ä½¿ç”¨IDEå¯åŠ¨
# è¿è¡Œ JeecgSystemApplication.java
```

### 3. æ•°æ®åº“åˆå§‹åŒ–

#### MySQLæ•°æ®åº“
```sql
-- åˆ›å»ºæ•°æ®åº“
CREATE DATABASE verto DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- åˆ›å»ºç”¨æˆ·
CREATE USER 'verto'@'%' IDENTIFIED BY 'verto123';
GRANT ALL PRIVILEGES ON verto.* TO 'verto'@'%';
FLUSH PRIVILEGES;

-- å¯¼å…¥åˆå§‹æ•°æ®
-- æ‰§è¡Œ jeecg-boot/db/jeecgboot-mysql-5.7.sql
```

#### Redisé…ç½®
```bash
# å¯åŠ¨Redisï¼ˆå¦‚æœä½¿ç”¨Dockerï¼‰
docker run -d --name redis -p 6379:6379 redis:7-alpine

# æˆ–è€…ä½¿ç”¨æœ¬åœ°RedisæœåŠ¡
# ç¡®ä¿RedisæœåŠ¡æ­£åœ¨è¿è¡Œ
```

## ğŸ”„ CI/CDé›†æˆæµç¨‹

### 1. GitLab CI/CDé…ç½®

#### .gitlab-ci.yml
```yaml
stages:
  - build
  - test
  - deploy

variables:
  MAVEN_OPTS: "-Dmaven.repo.local=$CI_PROJECT_DIR/.m2/repository"

cache:
  paths:
    - .m2/repository/
    - jeecgboot-vue3/node_modules/

frontend:build:
  stage: build
  image: node:18-alpine
  script:
    - cd jeecgboot-vue3
    - npm install -g pnpm
    - pnpm install --frozen-lockfile
    - pnpm build
  artifacts:
    paths:
      - jeecgboot-vue3/dist/
    expire_in: 1 hour

backend:build:
  stage: build
  image: maven:3.8.6-openjdk-8
  script:
    - cd jeecg-boot
    - mvn clean package -DskipTests
  artifacts:
    paths:
      - jeecg-boot/target/
    expire_in: 1 hour

deploy:dev:
  stage: deploy
  script:
    - echo "éƒ¨ç½²åˆ°å¼€å‘ç¯å¢ƒ"
    - docker-compose -f docker-compose.dev.yml up -d
  environment:
    name: development
    url: http://dev.verto.local
  only:
    - develop
```

### 2. Jenkins Pipelineé›†æˆ

#### Jenkinsfile
```groovy
pipeline {
    agent any
    
    environment {
        NODEJS_HOME = tool 'NodeJS'
        MAVEN_HOME = tool 'Maven'
        PATH = "${NODEJS_HOME}/bin:${MAVEN_HOME}/bin:${env.PATH}"
    }
    
    stages {
        stage('ä»£ç æ£€å‡º') {
            steps {
                git branch: 'main', 
                    url: 'http://gitlab:8080/root/verto.git',
                    credentialsId: 'gitlab-credentials'
            }
        }
        
        stage('å¹¶è¡Œæ„å»º') {
            parallel {
                stage('å‰ç«¯æ„å»º') {
                    steps {
                        dir('jeecgboot-vue3') {
                            bat 'pnpm install --frozen-lockfile'
                            bat 'pnpm build'
                        }
                    }
                }
                stage('åç«¯æ„å»º') {
                    steps {
                        dir('jeecg-boot') {
                            bat 'mvn clean package -DskipTests'
                        }
                    }
                }
            }
        }
        
        stage('æµ‹è¯•') {
            parallel {
                stage('å‰ç«¯æµ‹è¯•') {
                    steps {
                        dir('jeecgboot-vue3') {
                            bat 'pnpm test:unit'
                            bat 'pnpm lint'
                        }
                    }
                }
                stage('åç«¯æµ‹è¯•') {
                    steps {
                        dir('jeecg-boot') {
                            bat 'mvn test'
                        }
                    }
                }
            }
        }
        
        stage('éƒ¨ç½²') {
            when {
                branch 'main'
            }
            steps {
                script {
                    bat 'docker-compose -f docker-compose.prod.yml up -d'
                }
            }
        }
    }
    
    post {
        always {
            cleanWs()
        }
        success {
            echo 'æ„å»ºæˆåŠŸï¼'
        }
        failure {
            echo 'æ„å»ºå¤±è´¥ï¼'
        }
    }
}
```

## ğŸ³ Dockeré›†æˆ

### 1. åº”ç”¨å®¹å™¨åŒ–

#### å‰ç«¯Dockerfile
```dockerfile
# jeecgboot-vue3/Dockerfile
FROM node:18-alpine AS builder

WORKDIR /app
COPY package*.json pnpm-lock.yaml ./
RUN npm install -g pnpm && pnpm install --frozen-lockfile
COPY . .
RUN pnpm build

FROM nginx:alpine
COPY --from=builder /app/dist /usr/share/nginx/html
COPY nginx.conf /etc/nginx/nginx.conf
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
```

#### åç«¯Dockerfile
```dockerfile
# jeecg-boot/Dockerfile
FROM maven:3.8.6-openjdk-8 AS builder

WORKDIR /app
COPY pom.xml .
COPY jeecg-module-system/pom.xml jeecg-module-system/
RUN mvn dependency:go-offline -B

COPY . .
RUN mvn clean package -DskipTests -B

FROM openjdk:8-jre-alpine
WORKDIR /app
COPY --from=builder /app/jeecg-module-system/jeecg-system-start/target/*.jar app.jar
EXPOSE 8080
ENTRYPOINT ["java", "-jar", "app.jar"]
```

### 2. Docker Composeé›†æˆ

#### å®Œæ•´åº”ç”¨æ ˆ
```yaml
# docker-compose.yml
version: '3.8'

services:
  frontend:
    build: ./jeecgboot-vue3
    ports:
      - "3000:80"
    depends_on:
      - backend

  backend:
    build: ./jeecg-boot
    ports:
      - "8080:8080"
    environment:
      - SPRING_PROFILES_ACTIVE=docker
      - SPRING_DATASOURCE_URL=jdbc:mysql://mysql:3306/verto
      - SPRING_REDIS_HOST=redis
    depends_on:
      - mysql
      - redis

  mysql:
    image: mysql:8.0
    environment:
      - MYSQL_ROOT_PASSWORD=root123
      - MYSQL_DATABASE=verto
      - MYSQL_USER=verto
      - MYSQL_PASSWORD=verto123
    volumes:
      - mysql_data:/var/lib/mysql
      - ./db/init.sql:/docker-entrypoint-initdb.d/init.sql
    ports:
      - "3306:3306"

  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"

volumes:
  mysql_data:
```

## ğŸ” ç›‘æ§å’Œæ—¥å¿—é›†æˆ

### 1. åº”ç”¨ç›‘æ§

#### Spring Boot Actuator
```yaml
# application.yml
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: always
  metrics:
    export:
      prometheus:
        enabled: true
```

#### Prometheusé…ç½®
```yaml
# prometheus.yml
global:
  scrape_interval: 15s

scrape_configs:
  - job_name: 'verto-backend'
    static_configs:
      - targets: ['backend:8080']
    metrics_path: '/actuator/prometheus'
```

### 2. æ—¥å¿—é›†æˆ

#### Logbacké…ç½®
```xml
<!-- jeecg-boot/src/main/resources/logback-spring.xml -->
<configuration>
    <springProfile name="!prod">
        <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
            <encoder>
                <pattern>%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n</pattern>
            </encoder>
        </appender>
        <root level="INFO">
            <appender-ref ref="CONSOLE"/>
        </root>
    </springProfile>
    
    <springProfile name="prod">
        <appender name="FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
            <file>logs/verto.log</file>
            <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
                <fileNamePattern>logs/verto.%d{yyyy-MM-dd}.%i.log</fileNamePattern>
                <maxFileSize>100MB</maxFileSize>
                <maxHistory>30</maxHistory>
            </rollingPolicy>
            <encoder>
                <pattern>%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n</pattern>
            </encoder>
        </appender>
        <root level="INFO">
            <appender-ref ref="FILE"/>
        </root>
    </springProfile>
</configuration>
```

## ğŸ” å®‰å…¨é›†æˆ

### 1. è®¤è¯æˆæƒ

#### JWTé…ç½®
```java
// JwtConfig.java
@Configuration
public class JwtConfig {
    
    @Value("${jeecg.jwt.secret}")
    private String secret;
    
    @Value("${jeecg.jwt.expiration}")
    private Long expiration;
    
    @Bean
    public JwtTokenUtil jwtTokenUtil() {
        return new JwtTokenUtil(secret, expiration);
    }
}
```

#### æƒé™æ§åˆ¶
```java
// SecurityConfig.java
@Configuration
@EnableWebSecurity
public class SecurityConfig extends WebSecurityConfigurerAdapter {
    
    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http.csrf().disable()
            .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS)
            .and()
            .authorizeRequests()
            .antMatchers("/api/auth/**").permitAll()
            .antMatchers("/api/public/**").permitAll()
            .anyRequest().authenticated()
            .and()
            .addFilterBefore(jwtAuthenticationFilter(), UsernamePasswordAuthenticationFilter.class);
    }
}
```

### 2. æ•°æ®å®‰å…¨

#### æ•°æ®åº“åŠ å¯†
```yaml
# application.yml
jasypt:
  encryptor:
    password: ${JASYPT_PASSWORD:verto_secret}
    algorithm: PBEWithMD5AndDES
    iv-generator-classname: org.jasypt.iv.NoIvGenerator

spring:
  datasource:
    password: ENC(encrypted_password)
```

#### APIå®‰å…¨
```java
// ApiSecurityInterceptor.java
@Component
public class ApiSecurityInterceptor implements HandlerInterceptor {
    
    @Override
    public boolean preHandle(HttpServletRequest request, 
                           HttpServletResponse response, 
                           Object handler) throws Exception {
        // APIé™æµ
        // ç­¾åéªŒè¯
        // å‚æ•°æ ¡éªŒ
        return true;
    }
}
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–é›†æˆ

### 1. å‰ç«¯ä¼˜åŒ–

#### Viteé…ç½®ä¼˜åŒ–
```typescript
// vite.config.ts
export default defineConfig({
  build: {
    rollupOptions: {
      output: {
        manualChunks: {
          vendor: ['vue', 'vue-router', 'pinia'],
          antd: ['ant-design-vue'],
          utils: ['lodash', 'dayjs']
        }
      }
    },
    chunkSizeWarningLimit: 1000
  },
  server: {
    proxy: {
      '/api': {
        target: 'http://localhost:8080',
        changeOrigin: true
      }
    }
  }
});
```

#### ç¼“å­˜ç­–ç•¥
```typescript
// service-worker.js
const CACHE_NAME = 'verto-v1';
const urlsToCache = [
  '/',
  '/static/css/main.css',
  '/static/js/main.js'
];

self.addEventListener('install', event => {
  event.waitUntil(
    caches.open(CACHE_NAME)
      .then(cache => cache.addAll(urlsToCache))
  );
});
```

### 2. åç«¯ä¼˜åŒ–

#### æ•°æ®åº“ä¼˜åŒ–
```yaml
# application.yml
spring:
  datasource:
    hikari:
      maximum-pool-size: 20
      minimum-idle: 5
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000

mybatis-plus:
  configuration:
    cache-enabled: true
    lazy-loading-enabled: true
    multiple-result-sets-enabled: true
```

#### Redisç¼“å­˜
```java
// CacheConfig.java
@Configuration
@EnableCaching
public class CacheConfig {
    
    @Bean
    public CacheManager cacheManager(RedisConnectionFactory factory) {
        RedisCacheConfiguration config = RedisCacheConfiguration.defaultCacheConfig()
            .entryTtl(Duration.ofMinutes(30))
            .serializeKeysWith(RedisSerializationContext.SerializationPair.fromSerializer(new StringRedisSerializer()))
            .serializeValuesWith(RedisSerializationContext.SerializationPair.fromSerializer(new GenericJackson2JsonRedisSerializer()));
        
        return RedisCacheManager.builder(factory)
            .cacheDefaults(config)
            .build();
    }
}
```

---

## ğŸ’¡ é›†æˆæœ€ä½³å®è·µ

1. **ç¯å¢ƒéš”ç¦»**: å¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒå®Œå…¨éš”ç¦»
2. **è‡ªåŠ¨åŒ–éƒ¨ç½²**: ä½¿ç”¨CI/CDå®ç°è‡ªåŠ¨åŒ–éƒ¨ç½²
3. **ç›‘æ§å‘Šè­¦**: å®Œå–„çš„ç›‘æ§å’Œå‘Šè­¦æœºåˆ¶
4. **å®‰å…¨é˜²æŠ¤**: å¤šå±‚æ¬¡çš„å®‰å…¨é˜²æŠ¤æªæ–½
5. **æ€§èƒ½ä¼˜åŒ–**: å‰åç«¯æ€§èƒ½ä¼˜åŒ–ç­–ç•¥
6. **æ–‡æ¡£ç»´æŠ¤**: ä¿æŒæ–‡æ¡£çš„åŠæ—¶æ›´æ–°
7. **ç‰ˆæœ¬ç®¡ç†**: è§„èŒƒçš„ç‰ˆæœ¬ç®¡ç†å’Œå‘å¸ƒæµç¨‹

é€šè¿‡ä»¥ä¸Šé›†æˆæŒ‡å—ï¼Œæ‚¨å¯ä»¥å¿«é€Ÿæ­å»ºä¸€ä¸ªå®Œæ•´çš„ä¼ä¸šçº§åº”ç”¨å¼€å‘å’Œéƒ¨ç½²ç¯å¢ƒã€‚