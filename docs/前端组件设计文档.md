# 前端组件设计文档

## 文档信息
- **版本**: v1.0
- **创建日期**: 2025-01-18
- **最后更新**: 2025-01-18
- **维护人**: 前端开发团队

## 目录
1. [设计原则](#设计原则)
2. [技术栈](#技术栈)
3. [组件架构](#组件架构)
4. [组件规范](#组件规范)
5. [核心组件设计](#核心组件设计)
6. [业务组件设计](#业务组件设计)
7. [状态管理](#状态管理)
8. [路由设计](#路由设计)
9. [样式规范](#样式规范)
10. [性能优化](#性能优化)

## 设计原则

### 1. 组件化原则
- **单一职责**: 每个组件只负责一个功能
- **高内聚低耦合**: 组件内部逻辑紧密，组件间依赖最小
- **可复用性**: 组件设计要考虑复用场景
- **可扩展性**: 组件要易于扩展和维护

### 2. 数据流原则
- **单向数据流**: 数据从父组件流向子组件
- **事件向上传递**: 子组件通过事件向父组件传递信息
- **状态提升**: 共享状态提升到最近的公共父组件

### 3. 性能原则
- **按需加载**: 路由和组件按需加载
- **虚拟滚动**: 长列表使用虚拟滚动
- **缓存优化**: 合理使用组件缓存

## 技术栈

### 核心技术
- **Vue 3.3+**: 使用Composition API
- **TypeScript 5.0+**: 类型安全
- **Vite 4.0+**: 构建工具
- **Vue Router 4.0+**: 路由管理
- **Pinia**: 状态管理

### UI框架
- **JeecgBoot Vue3**: 基于Ant Design Vue的企业级组件库
  - **BasicTable**: 高级表格组件，支持搜索、分页、排序等
  - **BasicForm**: 动态表单组件，支持各种表单控件
  - **BasicModal**: 模态框组件，集成表单功能
  - **TableAction**: 表格操作列组件
  - **JCard/JTag/JButton**: 增强的基础组件
- **Ant Design Vue 4.0+**: 基础UI组件库
- **@ant-design/icons-vue**: 图标库
- **@vueuse/core**: Vue组合式工具库

### 工具库
- **axios**: HTTP客户端
- **dayjs**: 日期处理
- **lodash-es**: 工具函数
- **echarts**: 图表库
- **monaco-editor**: 代码编辑器

## 组件架构

### 目录结构（基于JeecgBoot）
```
src/
├── components/           # 组件目录
│   ├── Verto/           # Verto业务组件（基于JeecgBoot组件库）
│   │   ├── RequirementTable.vue    # 需求表格（基于BasicTable）
│   │   ├── RequirementModal.vue    # 需求表单（基于BasicModal）
│   │   ├── RequirementCard.vue     # 需求卡片（基于JCard）
│   │   ├── ApplicationCard.vue     # 应用卡片
│   │   ├── MaterialCard.vue        # 物料卡片
│   │   ├── PersonnelTable.vue      # 人员表格
│   │   ├── requirement.data.ts     # 需求数据配置
│   │   ├── application.data.ts     # 应用数据配置
│   │   ├── material.data.ts        # 物料数据配置
│   │   ├── personnel.data.ts       # 人员数据配置
│   │   └── index.ts                # 导出文件
│   ├── Common/          # 通用组件扩展
│   │   ├── VertoUpload/ # 文件上传组件
│   │   ├── VertoChart/  # 图表组件
│   │   ├── VertoTree/   # 树形组件
│   │   └── index.ts     # 导出文件
│   └── Layout/          # 布局组件（继承JeecgBoot布局）
│       ├── VertoHeader/ # 自定义头部
│       ├── VertoMenu/   # 自定义菜单
│       └── index.ts     # 导出文件
├── views/               # 页面组件
│   ├── requirement/     # 需求管理
│   ├── application/     # 应用管理
│   ├── material/        # 物料管理
│   ├── personnel/       # 人员管理
│   ├── project/         # 项目管理
│   └── dashboard/       # 仪表板
├── layouts/             # 布局模板
├── stores/              # 状态管理
├── composables/         # 组合式函数
├── utils/               # 工具函数
├── types/               # 类型定义
│   └── verto/           # Verto业务类型
│       ├── requirement.ts
│       ├── application.ts
│       ├── material.ts
│       └── personnel.ts
└── styles/              # 样式文件
```

### 组件分层
```
┌─────────────────┐
│   页面组件 (Views)  │  业务页面，组合多个组件
├─────────────────┤
│  业务组件 (Business) │  特定业务逻辑的组件
├─────────────────┤
│  通用组件 (Common)   │  可复用的功能组件
├─────────────────┤
│  基础组件 (Basic)    │  最基础的UI组件
└─────────────────┘
```

## 组件规范

### 1. 命名规范
- **组件文件**: PascalCase，如 `UserTable.vue`
- **组件名称**: PascalCase，如 `UserTable`
- **Props**: camelCase，如 `dataSource`
- **Events**: kebab-case，如 `update:value`
- **Slots**: kebab-case，如 `header-extra`

### 2. 文件结构
```vue
<template>
  <!-- 模板内容 -->
</template>

<script setup lang="ts">
// 导入
import { ref, computed, onMounted } from 'vue'
import type { PropType } from 'vue'

// 类型定义
interface Props {
  // props类型
}

interface Emits {
  // emits类型
}

// Props定义
const props = defineProps<Props>()

// Emits定义
const emit = defineEmits<Emits>()

// 响应式数据
const loading = ref(false)

// 计算属性
const computedValue = computed(() => {
  // 计算逻辑
})

// 方法
const handleClick = () => {
  // 处理逻辑
}

// 生命周期
onMounted(() => {
  // 初始化逻辑
})

// 暴露给父组件的方法
defineExpose({
  handleClick
})
</script>

<style scoped>
/* 组件样式 */
</style>
```

### 3. Props设计
```typescript
// 基础Props
interface BaseProps {
  id?: string
  className?: string
  style?: CSSProperties
  loading?: boolean
  disabled?: boolean
}

// 表格Props示例
interface TableProps extends BaseProps {
  dataSource: any[]
  columns: TableColumn[]
  pagination?: PaginationConfig | false
  rowSelection?: RowSelection
  scroll?: { x?: number; y?: number }
  size?: 'small' | 'middle' | 'large'
}
```

### 4. Events设计
```typescript
// 事件定义
interface TableEmits {
  'update:selectedRowKeys': [keys: string[]]
  'change': [pagination: any, filters: any, sorter: any]
  'row-click': [record: any, index: number]
  'row-dblclick': [record: any, index: number]
}
```

## 核心组件设计

### 1. 基于BasicTable的数据表格组件

**功能特性**（继承JeecgBoot BasicTable）:
- 集成搜索表单与数据表格
- 自动分页、排序、筛选
- 支持行选择、批量操作
- 表格设置（列显示/隐藏、列宽调整）
- 自定义操作列（TableAction）
- API自动调用与数据绑定
- 支持虚拟滚动和导出功能

**组件接口**:
```typescript
// 基于JeecgBoot的BasicTable配置
interface VertoTableConfig {
  title: string                    // 表格标题
  api: Function                   // 数据API
  columns: BasicColumn[]          // 列配置
  formConfig?: {                  // 搜索表单配置
    labelWidth: number
    schemas: FormSchema[]
    autoSubmitOnEnter: boolean
  }
  useSearchForm?: boolean         // 是否使用搜索表单
  showTableSetting?: boolean      // 是否显示表格设置
  rowSelection?: RowSelectionConfig // 行选择配置
  actionColumn?: ActionColumn     // 操作列配置
  beforeFetch?: (params: any) => any // 请求前处理
  afterFetch?: (data: any) => any    // 请求后处理
}

interface BasicColumn {
  title: string                   // 列标题
  dataIndex: string              // 数据字段
  width?: number                 // 列宽
  sorter?: boolean               // 是否可排序
  ellipsis?: boolean             // 超长省略
  customRender?: Function        // 自定义渲染
  slots?: { customRender: string } // 插槽渲染
}

interface ActionColumn {
  width: number                  // 操作列宽度
  title: string                  // 操作列标题
  dataIndex: string              // 数据字段
  slots: { customRender: string } // 插槽名称
}
```

**使用示例**:
```vue
<template>
  <div class="verto-table">
    <BasicTable
      @register="registerTable"
      :searchInfo="searchInfo"
      :rowSelection="{ type: 'checkbox', selectedRowKeys: checkedKeys, onChange: onSelectChange }"
    >
      <template #tableTitle>
        <a-button
          type="primary"
          @click="handleAdd"
          preIcon="ant-design:plus-outlined"
        >
          新增
        </a-button>
      </template>
      
      <template #status="{ record }">
        <j-tag :color="getStatusColor(record.status)">
          {{ getStatusText(record.status) }}
        </j-tag>
      </template>
      
      <template #action="{ record }">
        <TableAction
          :actions="[
            {
              icon: 'clarity:note-edit-line',
              tooltip: '编辑',
              onClick: handleEdit.bind(null, record),
            },
            {
              icon: 'ant-design:delete-outlined',
              color: 'error',
              tooltip: '删除',
              popConfirm: {
                title: '是否确认删除',
                confirm: handleDelete.bind(null, record),
              },
            },
          ]"
        />
      </template>
    </BasicTable>
  </div>
</template>

<script setup lang="ts">
import { ref, reactive } from 'vue'
import { BasicTable, useTable, TableAction } from '/@/components/Table'
import { useMessage } from '/@/hooks/web/useMessage'
import { columns, searchFormSchema } from './data'
import { getDataList, deleteData } from '/@/api/verto/data'

const { createMessage } = useMessage()
const checkedKeys = ref<Array<string | number>>([])

// 使用JeecgBoot的useTable hook
const [registerTable, { reload, getForm }] = useTable({
  title: '数据列表',
  api: getDataList,
  rowKey: 'id',
  columns,
  formConfig: {
    labelWidth: 120,
    schemas: searchFormSchema,
    autoSubmitOnEnter: true,
  },
  useSearchForm: true,
  showTableSetting: true,
  bordered: true,
  actionColumn: {
    width: 120,
    title: '操作',
    dataIndex: 'action',
    slots: { customRender: 'action' },
  },
})

const searchInfo = reactive<Recordable>({})

function onSelectChange(selectedRowKeys: (string | number)[]) {
  checkedKeys.value = selectedRowKeys
}

function handleAdd() {
  // 新增逻辑
}

function handleEdit(record: Recordable) {
  // 编辑逻辑
}

function handleDelete(record: Recordable) {
  deleteData(record.id).then(() => {
    createMessage.success('删除成功')
    reload()
  })
}

function getStatusColor(status: string) {
  const colorMap = {
    active: 'success',
    inactive: 'default'
  }
  return colorMap[status] || 'default'
}

function getStatusText(status: string) {
  const textMap = {
    active: '启用',
    inactive: '禁用'
  }
  return textMap[status] || status
}
</script>
```

### 2. 基于BasicForm的表单组件

**功能特性**（继承JeecgBoot BasicForm）:
- 动态表单生成与配置
- 内置表单验证规则
- 丰富的表单控件（Input、Select、DatePicker、Upload等）
- 响应式布局与栅格系统
- 表单联动与条件显示
- 与BasicModal无缝集成

**组件接口**:
```typescript
// 基于JeecgBoot的BasicForm配置
interface VertoFormConfig {
  labelWidth: number           // 标签宽度
  baseColProps: { span: number } // 基础栅格配置
  schemas: FormSchema[]        // 表单项配置
  showActionButtonGroup?: boolean // 是否显示操作按钮组
  autoSubmitOnEnter?: boolean  // 回车自动提交
  resetButtonOptions?: ButtonOptions // 重置按钮配置
  submitButtonOptions?: ButtonOptions // 提交按钮配置
  actionColOptions?: ColEx     // 操作列配置
}

interface FormSchema {
  field: string               // 字段名
  label: string              // 标签文本
  component: ComponentType   // 组件类型
  componentProps?: any       // 组件属性
  required?: boolean         // 是否必填
  rules?: ValidationRule[]   // 验证规则
  show?: boolean | ((values: any) => boolean) // 显示条件
  ifShow?: boolean | ((values: any) => boolean) // 条件显示
  colProps?: ColEx          // 栅格配置
  slot?: string             // 插槽名称
  defaultValue?: any        // 默认值
  helpMessage?: string      // 帮助信息
}

// 支持的组件类型
type ComponentType = 
  | 'Input'
  | 'InputTextArea' 
  | 'InputNumber'
  | 'Select'
  | 'ApiSelect'        // API数据选择器
  | 'TreeSelect'
  | 'DatePicker'
  | 'RangePicker'
  | 'TimePicker'
  | 'Switch'
  | 'RadioGroup'
  | 'CheckboxGroup'
  | 'Upload'
  | 'Slider'
  | 'Rate'
  | 'Cascader'
```

**使用示例**:
```vue
<template>
  <BasicModal
    v-bind="$attrs"
    @register="registerModal"
    :title="getTitle"
    @ok="handleSubmit"
  >
    <BasicForm @register="registerForm" />
  </BasicModal>
</template>

<script setup lang="ts">
import { ref, computed, unref } from 'vue'
import { BasicModal, useModalInner } from '/@/components/Modal'
import { BasicForm, useForm } from '/@/components/Form'
import { formSchema } from './data'
import { createData, updateData } from '/@/api/verto/data'

const emit = defineEmits(['success', 'register'])

const isUpdate = ref(true)
const rowId = ref('')

// 使用JeecgBoot的useForm hook
const [registerForm, { setFieldsValue, updateSchema, resetFields, validate }] = useForm({
  labelWidth: 100,
  baseColProps: { span: 24 },
  schemas: formSchema,
  showActionButtonGroup: false,
  autoSubmitOnEnter: true,
})

const [registerModal, { setModalProps, closeModal }] = useModalInner(async (data) => {
  resetFields()
  setModalProps({ confirmLoading: false })
  isUpdate.value = !!data?.isUpdate

  if (unref(isUpdate)) {
    rowId.value = data.record.id
    setFieldsValue({
      ...data.record,
    })
  }

  // 动态更新表单schema
  updateSchema([
    {
      field: 'code',
      componentProps: {
        disabled: unref(isUpdate),
      },
    },
  ])
})

const getTitle = computed(() => (!unref(isUpdate) ? '新增' : '编辑'))

async function handleSubmit() {
  try {
    const values = await validate()
    setModalProps({ confirmLoading: true })
    
    if (unref(isUpdate)) {
      await updateData({ ...values, id: rowId.value })
    } else {
      await createData(values)
    }
    
    closeModal()
    emit('success')
  } finally {
    setModalProps({ confirmLoading: false })
  }
}
</script>
```

**表单配置示例**:
```typescript
// data.ts
import { FormSchema } from '/@/components/Table'
import { useUserStore } from '/@/store/modules/user'

export const formSchema: FormSchema[] = [
  {
    field: 'name',
    label: '名称',
    component: 'Input',
    required: true,
    colProps: { span: 12 },
  },
  {
    field: 'code',
    label: '编码',
    component: 'Input',
    required: true,
    colProps: { span: 12 },
  },
  {
    field: 'type',
    label: '类型',
    component: 'Select',
    componentProps: {
      options: [
        { label: '类型1', value: 'type1' },
        { label: '类型2', value: 'type2' },
      ],
    },
    required: true,
    colProps: { span: 12 },
  },
  {
    field: 'assigneeId',
    label: '负责人',
    component: 'ApiSelect',
    componentProps: {
      api: () => import('/@/api/system/user').then(m => m.getUserList()),
      labelField: 'realName',
      valueField: 'id',
      immediate: true,
    },
    colProps: { span: 12 },
  },
  {
    field: 'startDate',
    label: '开始日期',
    component: 'DatePicker',
    componentProps: {
      format: 'YYYY-MM-DD',
      valueFormat: 'YYYY-MM-DD',
    },
    colProps: { span: 12 },
  },
  {
    field: 'endDate',
    label: '结束日期',
    component: 'DatePicker',
    componentProps: {
      format: 'YYYY-MM-DD',
      valueFormat: 'YYYY-MM-DD',
    },
    colProps: { span: 12 },
  },
  {
    field: 'description',
    label: '描述',
    component: 'InputTextArea',
    componentProps: {
      rows: 4,
      maxlength: 500,
      showCount: true,
    },
    colProps: { span: 24 },
  },
  {
    field: 'status',
    label: '状态',
    component: 'Switch',
    componentProps: {
      checkedChildren: '启用',
      unCheckedChildren: '禁用',
    },
    defaultValue: true,
    colProps: { span: 12 },
  },
]
```

### 3. 基于BasicForm的搜索组件

**功能特性**（继承JeecgBoot BasicForm）:
- 快速搜索表单生成与配置
- 支持展开/收起高级搜索
- 内置常用搜索控件（Input、Select、DatePicker、RangePicker等）
- 搜索条件联动与动态显示
- 与BasicTable无缝集成
- 支持搜索条件缓存

**组件接口**:
```typescript
// 基于JeecgBoot的搜索表单配置
interface VertoSearchConfig {
  labelWidth: number           // 标签宽度
  baseColProps: { span: number } // 基础栅格配置
  schemas: FormSchema[]        // 搜索项配置
  autoSubmitOnEnter?: boolean  // 回车自动搜索
  showAdvancedButton?: boolean // 显示高级搜索按钮
  showResetButton?: boolean    // 显示重置按钮
  resetFunc?: () => Promise<void> // 重置函数
  submitFunc?: (values: any) => Promise<void> // 提交函数
  compact?: boolean           // 紧凑模式
  actionColOptions?: ColEx    // 操作列配置
}

interface SearchFormSchema {
  field: string               // 字段名
  label: string              // 标签文本
  component: ComponentType   // 组件类型
  componentProps?: any       // 组件属性
  defaultValue?: any         // 默认值
  show?: boolean | ((values: any) => boolean) // 显示条件
  colProps?: ColEx          // 栅格配置
  isAdvanced?: boolean      // 是否为高级搜索项
  slot?: string             // 插槽名称
}

// 搜索组件类型
type SearchComponentType = 
  | 'Input'                // 输入框
  | 'Select'              // 下拉选择
  | 'ApiSelect'           // API数据选择器
  | 'TreeSelect'          // 树形选择
  | 'DatePicker'          // 日期选择
  | 'RangePicker'         // 日期范围选择
  | 'MonthPicker'         // 月份选择
  | 'TimePicker'          // 时间选择
  | 'InputNumber'         // 数字输入
  | 'Cascader'            // 级联选择
  | 'RadioGroup'          // 单选组
  | 'CheckboxGroup'       // 多选组
```

**使用示例**:
```vue
<template>
  <div>
    <!-- 搜索表单 -->
    <BasicForm 
      @register="registerForm" 
      @submit="handleSubmit" 
      @reset="handleReset"
    />
    
    <!-- 数据表格 -->
    <BasicTable @register="registerTable" />
  </div>
</template>

<script setup lang="ts">
import { BasicForm, useForm } from '/@/components/Form'
import { BasicTable, useTable } from '/@/components/Table'
import { searchFormSchema, columns } from './data'
import { getDataList } from '/@/api/verto/data'

// 搜索表单配置
const [registerForm, { getFieldsValue, resetFields }] = useForm({
  labelWidth: 80,
  baseColProps: { span: 6 },
  schemas: searchFormSchema,
  autoSubmitOnEnter: true,
  showAdvancedButton: true,
  showResetButton: true,
  compact: true,
  actionColOptions: {
    span: 24,
    style: { textAlign: 'right' },
  },
})

// 数据表格配置
const [registerTable, { reload, getForm }] = useTable({
  title: '数据列表',
  api: getDataList,
  columns,
  formConfig: {
    labelWidth: 80,
    schemas: searchFormSchema,
    autoSubmitOnEnter: true,
    showAdvancedButton: true,
  },
  useSearchForm: true,
  showTableSetting: true,
  bordered: true,
  showIndexColumn: false,
  actionColumn: {
    width: 120,
    title: '操作',
    dataIndex: 'action',
    fixed: undefined,
  },
})

// 搜索提交
function handleSubmit() {
  const values = getFieldsValue()
  console.log('搜索条件:', values)
  reload()
}

// 重置搜索
function handleReset() {
  resetFields()
  reload()
}
</script>
```

**搜索配置示例**:
```typescript
// data.ts
import { FormSchema } from '/@/components/Table'
import { getDictOptions } from '/@/api/system/dict'

export const searchFormSchema: FormSchema[] = [
  {
    field: 'keyword',
    label: '关键词',
    component: 'Input',
    componentProps: {
      placeholder: '请输入名称或编码',
      allowClear: true,
    },
    colProps: { span: 6 },
  },
  {
    field: 'status',
    label: '状态',
    component: 'Select',
    componentProps: {
      placeholder: '请选择状态',
      allowClear: true,
      options: [
        { label: '启用', value: '1' },
        { label: '禁用', value: '0' },
      ],
    },
    colProps: { span: 4 },
  },
  {
    field: 'type',
    label: '类型',
    component: 'ApiSelect',
    componentProps: {
      placeholder: '请选择类型',
      allowClear: true,
      api: () => getDictOptions('data_type'),
      labelField: 'text',
      valueField: 'value',
    },
    colProps: { span: 4 },
  },
  {
    field: 'createTime',
    label: '创建时间',
    component: 'RangePicker',
    componentProps: {
      format: 'YYYY-MM-DD',
      valueFormat: 'YYYY-MM-DD',
      placeholder: ['开始日期', '结束日期'],
    },
    colProps: { span: 6 },
    isAdvanced: true,
  },
  {
    field: 'assigneeId',
    label: '负责人',
    component: 'ApiSelect',
    componentProps: {
      placeholder: '请选择负责人',
      allowClear: true,
      api: () => import('/@/api/system/user').then(m => m.getUserList()),
      labelField: 'realName',
      valueField: 'id',
    },
    colProps: { span: 4 },
    isAdvanced: true,
  },
  {
    field: 'priority',
    label: '优先级',
    component: 'Select',
    componentProps: {
      placeholder: '请选择优先级',
      allowClear: true,
      options: [
        { label: '高', value: 'high' },
        { label: '中', value: 'medium' },
        { label: '低', value: 'low' },
      ],
    },
    colProps: { span: 4 },
    isAdvanced: true,
  },
]
```

**与BasicTable集成示例**:
```vue
<template>
  <div>
    <BasicTable @register="registerTable">
      <!-- 工具栏插槽 -->
      <template #toolbar>
        <a-button type="primary" @click="handleAdd">
          <Icon icon="ant-design:plus-outlined" />
          新增
        </a-button>
      </template>
      
      <!-- 操作列插槽 -->
      <template #action="{ record }">
        <TableAction
          :actions="[
            {
              icon: 'clarity:edit-line',
              onClick: handleEdit.bind(null, record),
            },
            {
              icon: 'ant-design:delete-outlined',
              color: 'error',
              popConfirm: {
                title: '是否确认删除',
                confirm: handleDelete.bind(null, record),
              },
            },
          ]"
        />
      </template>
    </BasicTable>
  </div>
</template>

<script setup lang="ts">
import { BasicTable, useTable, TableAction } from '/@/components/Table'
import { useModal } from '/@/components/Modal'
import { columns, searchFormSchema } from './data'
import { getDataList, deleteData } from '/@/api/verto/data'
import DataModal from './DataModal.vue'

const [registerModal, { openModal }] = useModal()

const [registerTable, { reload }] = useTable({
  title: '数据管理',
  api: getDataList,
  columns,
  formConfig: {
    labelWidth: 80,
    schemas: searchFormSchema,
    autoSubmitOnEnter: true,
    showAdvancedButton: true,
    showResetButton: true,
  },
  useSearchForm: true,
  showTableSetting: true,
  bordered: true,
  actionColumn: {
    width: 120,
    title: '操作',
    dataIndex: 'action',
  },
})

function handleAdd() {
  openModal(true, {
    isUpdate: false,
  })
}

function handleEdit(record: Recordable) {
  openModal(true, {
    record,
    isUpdate: true,
  })
}

async function handleDelete(record: Recordable) {
  await deleteData(record.id)
  reload()
}
</script>
```

### 4. 基于JeecgBoot的卡片列表组件

**功能特性**（基于JeecgBoot组件）:
- 响应式卡片网格布局
- 集成BasicTable的分页功能
- 支持卡片模板自定义
- 内置加载状态与空数据处理
- 支持卡片操作（编辑、删除等）
- 与搜索表单联动

**组件接口**:
```typescript
// 基于JeecgBoot的卡片列表配置
interface VertoCardListConfig {
  api: (params: any) => Promise<any> // 数据API
  columns?: BasicColumn[]      // 列配置（用于数据处理）
  cardRender: (record: any, index: number) => VNode // 卡片渲染函数
  gridProps?: GridProps       // 栅格配置
  pagination?: PaginationProps // 分页配置
  searchFormConfig?: FormConfig // 搜索表单配置
  showSearch?: boolean        // 是否显示搜索
  showToolbar?: boolean       // 是否显示工具栏
  immediate?: boolean         // 是否立即加载
}

interface GridProps {
  gutter?: number | [number, number] // 间距
  xs?: number | ColProps      // <576px 响应式栅格
  sm?: number | ColProps      // ≥576px 响应式栅格
  md?: number | ColProps      // ≥768px 响应式栅格
  lg?: number | ColProps      // ≥992px 响应式栅格
  xl?: number | ColProps      // ≥1200px 响应式栅格
  xxl?: number | ColProps     // ≥1600px 响应式栅格
}

interface CardListEmits {
  (e: 'register', instance: CardListActionType): void
  (e: 'card-click', record: any, index: number): void
  (e: 'card-action', action: string, record: any): void
}

interface CardListActionType {
  reload: (opt?: FetchParams) => Promise<void>
  getDataSource: () => any[]
  setLoading: (loading: boolean) => void
  getLoading: () => boolean
  setProps: (props: Partial<VertoCardListConfig>) => void
}
```

**使用示例**:
```vue
<template>
  <div class="verto-card-list">
    <!-- 搜索表单 -->
    <BasicForm 
      v-if="showSearch"
      @register="registerForm" 
      @submit="handleSearch" 
      @reset="handleReset"
    />
    
    <!-- 工具栏 -->
    <div v-if="showToolbar" class="card-list-toolbar">
      <div class="toolbar-left">
        <slot name="toolbar" />
      </div>
      <div class="toolbar-right">
        <a-space>
          <a-button @click="handleRefresh">
            <Icon icon="ant-design:reload-outlined" />
            刷新
          </a-button>
          <a-dropdown>
            <a-button>
              <Icon icon="ant-design:setting-outlined" />
              设置
            </a-button>
            <template #overlay>
              <a-menu>
                <a-menu-item @click="toggleViewMode">
                  <Icon icon="ant-design:appstore-outlined" />
                  切换视图
                </a-menu-item>
              </a-menu>
            </template>
          </a-dropdown>
        </a-space>
      </div>
    </div>
    
    <!-- 卡片列表 -->
    <div class="card-list-content">
      <a-spin :spinning="loading">
        <a-row :gutter="gridProps.gutter">
          <a-col 
            v-for="(record, index) in dataSource" 
            :key="record.id || index"
            v-bind="getColProps()"
          >
            <div 
              class="card-wrapper"
              @click="handleCardClick(record, index)"
            >
              <!-- 自定义卡片内容 -->
              <component 
                :is="cardRender(record, index)" 
                @action="handleCardAction($event, record)"
              />
            </div>
          </a-col>
        </a-row>
        
        <!-- 空数据 -->
        <a-empty v-if="!loading && dataSource.length === 0" />
      </a-spin>
    </div>
    
    <!-- 分页 -->
    <div v-if="pagination && dataSource.length > 0" class="card-list-pagination">
      <a-pagination
        v-model:current="pagination.current"
        v-model:pageSize="pagination.pageSize"
        :total="pagination.total"
        :show-size-changer="pagination.showSizeChanger"
        :show-quick-jumper="pagination.showQuickJumper"
        :show-total="(total, range) => `第 ${range[0]}-${range[1]} 条/共 ${total} 条`"
        @change="handlePageChange"
        @showSizeChange="handlePageSizeChange"
      />
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, reactive, computed, unref, onMounted } from 'vue'
import { BasicForm, useForm } from '/@/components/Form'
import { Icon } from '/@/components/Icon'
import { useLoading } from '/@/hooks/core/useLoading'
import type { VertoCardListConfig, CardListEmits, CardListActionType } from './types'

interface Props extends VertoCardListConfig {}

const props = withDefaults(defineProps<Props>(), {
  immediate: true,
  showSearch: true,
  showToolbar: true,
  gridProps: () => ({
    gutter: [16, 16],
    xs: 24,
    sm: 12,
    md: 8,
    lg: 6,
    xl: 6,
    xxl: 4,
  }),
})

const emit = defineEmits<CardListEmits>()

const [loading, setLoading] = useLoading(false)
const dataSource = ref<any[]>([])
const pagination = reactive({
  current: 1,
  pageSize: 12,
  total: 0,
  showSizeChanger: true,
  showQuickJumper: true,
  ...props.pagination,
})

// 搜索表单
const [registerForm, { getFieldsValue, resetFields }] = useForm({
  labelWidth: 80,
  baseColProps: { span: 6 },
  schemas: props.searchFormConfig?.schemas || [],
  autoSubmitOnEnter: true,
  showAdvancedButton: true,
  showResetButton: true,
  compact: true,
})

// 响应式栅格配置
const getColProps = () => {
  const { xs, sm, md, lg, xl, xxl } = props.gridProps
  return { xs, sm, md, lg, xl, xxl }
}

// 加载数据
async function fetch(params: any = {}) {
  if (!props.api) return
  
  try {
    setLoading(true)
    const searchParams = props.showSearch ? getFieldsValue() : {}
    const requestParams = {
      ...searchParams,
      ...params,
      pageNo: pagination.current,
      pageSize: pagination.pageSize,
    }
    
    const result = await props.api(requestParams)
    
    if (result) {
      dataSource.value = result.records || result.data || []
      pagination.total = result.total || 0
    }
  } catch (error) {
    console.error('CardList fetch error:', error)
  } finally {
    setLoading(false)
  }
}

// 搜索
function handleSearch() {
  pagination.current = 1
  fetch()
}

// 重置
function handleReset() {
  resetFields()
  pagination.current = 1
  fetch()
}

// 刷新
function handleRefresh() {
  fetch()
}

// 分页变化
function handlePageChange(page: number, pageSize: number) {
  pagination.current = page
  pagination.pageSize = pageSize
  fetch()
}

// 页大小变化
function handlePageSizeChange(current: number, size: number) {
  pagination.current = 1
  pagination.pageSize = size
  fetch()
}

// 卡片点击
function handleCardClick(record: any, index: number) {
  emit('card-click', record, index)
}

// 卡片操作
function handleCardAction(action: string, record: any) {
  emit('card-action', action, record)
}

// 切换视图模式
function toggleViewMode() {
  // 实现视图模式切换逻辑
}

// 暴露方法
const cardListAction: CardListActionType = {
  reload: fetch,
  getDataSource: () => unref(dataSource),
  setLoading,
  getLoading: () => unref(loading),
  setProps: (newProps) => {
    Object.assign(props, newProps)
  },
}

onMounted(() => {
  emit('register', cardListAction)
  if (props.immediate) {
    fetch()
  }
})
</script>

<style scoped>
.verto-card-list {
  .card-list-toolbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
    padding: 12px 0;
    border-bottom: 1px solid #f0f0f0;
  }
  
  .card-list-content {
    min-height: 200px;
  }
  
  .card-wrapper {
    margin-bottom: 16px;
    cursor: pointer;
    transition: all 0.3s;
    
    &:hover {
      transform: translateY(-2px);
    }
  }
  
  .card-list-pagination {
    margin-top: 24px;
    text-align: center;
  }
}
</style>
```

## 6. 业务组件设计

### 6.1 基于JeecgBoot的需求卡片组件

#### 功能特性（基于JeecgBoot组件）
- 使用j-card组件展示需求信息
- 集成j-tag显示状态和优先级
- 支持快速操作与状态变更
- 响应式设计与拖拽排序
- 集成JeecgBoot的消息提示

#### 组件实现

```vue
<!-- RequirementCard.vue -->
<template>
  <j-card hoverable class="requirement-card" :class="cardClass">
    <template #title>
      <div class="card-title">
        <span class="title-text">{{ record.title }}</span>
        <j-tag :color="getStatusColor(record.status)">
          {{ getStatusText(record.status) }}
        </j-tag>
      </div>
    </template>
    
    <template #extra>
      <a-dropdown>
        <j-button type="text" size="small">
          <Icon icon="ant-design:more-outlined" />
        </j-button>
        <template #overlay>
          <a-menu @click="handleMenuClick">
            <a-menu-item key="edit">
              <Icon icon="ant-design:edit-outlined" />
              编辑
            </a-menu-item>
            <a-menu-item key="copy">
              <Icon icon="ant-design:copy-outlined" />
              复制
            </a-menu-item>
            <a-menu-item key="delete">
              <Icon icon="ant-design:delete-outlined" />
              删除
            </a-menu-item>
          </a-menu>
        </template>
      </a-dropdown>
    </template>
    
    <div class="card-content">
      <p class="description">{{ record.description || '暂无描述' }}</p>
      
      <div class="meta-info">
        <div class="meta-item">
          <Icon icon="ant-design:user-outlined" />
          <span>{{ record.assigneeName || '未分配' }}</span>
        </div>
        <div class="meta-item">
          <Icon icon="ant-design:calendar-outlined" />
          <span>{{ formatDate(record.endDate) || '未设置' }}</span>
        </div>
        <div class="meta-item">
          <Icon icon="ant-design:clock-circle-outlined" />
          <span>{{ record.estimatedHours || 0 }}h</span>
        </div>
        <div class="meta-item">
          <Icon icon="ant-design:flag-outlined" />
          <j-tag size="small" :color="getPriorityColor(record.priority)">
            {{ getPriorityText(record.priority) }}
          </j-tag>
        </div>
      </div>
      
      <!-- 进度条 -->
      <div class="progress-section">
        <div class="progress-label">
          <span>完成进度</span>
          <span class="progress-text">{{ record.completionRate || 0 }}%</span>
        </div>
        <a-progress 
          :percent="record.completionRate || 0" 
          size="small"
          :stroke-color="getProgressColor(record.completionRate)"
          :show-info="false"
        />
      </div>
    </div>
    
    <template #actions>
      <a key="view" @click="handleAction('view')">
        <Icon icon="ant-design:eye-outlined" />
        查看
      </a>
      <a key="edit" @click="handleAction('edit')">
        <Icon icon="ant-design:edit-outlined" />
        编辑
      </a>
      <a key="status" @click="handleAction('status')">
        <Icon icon="ant-design:check-circle-outlined" />
        {{ getNextStatusText(record.status) }}
      </a>
    </template>
  </j-card>
</template>

<script setup lang="ts">
import { computed } from 'vue'
import { Icon } from '/@/components/Icon'
import { useMessage } from '/@/hooks/web/useMessage'
import { formatDate } from '/@/utils/dateUtil'
import type { RequirementRecord } from '/@/api/verto/model/requirementModel'

interface Props {
  record: RequirementRecord
  index: number
  draggable?: boolean
}

interface Emits {
  (e: 'action', action: string, record: RequirementRecord): void
  (e: 'menu-click', key: string, record: RequirementRecord): void
}

const props = withDefaults(defineProps<Props>(), {
  draggable: false,
})

const emit = defineEmits<Emits>()
const { createMessage } = useMessage()

// 计算卡片样式类
const cardClass = computed(() => ({
  'draggable-card': props.draggable,
  [`status-${props.record.status}`]: true,
  [`priority-${props.record.priority}`]: true,
}))

// 状态相关方法
function getStatusColor(status: string) {
  const colorMap = {
    'pending': 'orange',
    'in_progress': 'blue', 
    'testing': 'cyan',
    'completed': 'green',
    'cancelled': 'red',
    'on_hold': 'purple',
  }
  return colorMap[status] || 'default'
}

function getStatusText(status: string) {
  const textMap = {
    'pending': '待处理',
    'in_progress': '进行中',
    'testing': '测试中', 
    'completed': '已完成',
    'cancelled': '已取消',
    'on_hold': '暂停',
  }
  return textMap[status] || status
}

function getNextStatusText(status: string) {
  const nextStatusMap = {
    'pending': '开始',
    'in_progress': '完成',
    'testing': '通过',
    'completed': '重开',
    'cancelled': '重开',
    'on_hold': '继续',
  }
  return nextStatusMap[status] || '更新'
}

// 优先级相关方法
function getPriorityColor(priority: string) {
  const colorMap = {
    'urgent': 'red',
    'high': 'orange',
    'medium': 'blue',
    'low': 'green',
  }
  return colorMap[priority] || 'default'
}

function getPriorityText(priority: string) {
  const textMap = {
    'urgent': '紧急',
    'high': '高',
    'medium': '中',
    'low': '低',
  }
  return textMap[priority] || priority
}

// 进度条颜色
function getProgressColor(percent: number) {
  if (percent >= 80) return '#52c41a'
  if (percent >= 60) return '#1890ff'
  if (percent >= 40) return '#faad14'
  return '#f5222d'
}

// 事件处理
function handleAction(action: string) {
  emit('action', action, props.record)
}

function handleMenuClick({ key }: { key: string }) {
  emit('menu-click', key, props.record)
  
  // 显示操作反馈
  const actionMap = {
    'edit': '编辑需求',
    'copy': '复制需求', 
    'delete': '删除需求',
  }
  
  if (actionMap[key]) {
    createMessage.info(`正在${actionMap[key]}...`)
  }
}
</script>

<style scoped>
.requirement-card {
  height: 100%;
  transition: all 0.3s ease;
  
  &:hover {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  }
  
  &.draggable-card {
    cursor: move;
  }
  
  .card-title {
    display: flex;
    justify-content: space-between;
    align-items: center;
    
    .title-text {
      font-weight: 500;
      font-size: 14px;
      flex: 1;
      margin-right: 8px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
  }
  
  .card-content {
    .description {
      color: #666;
      margin-bottom: 16px;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      text-overflow: ellipsis;
      line-height: 1.5;
      min-height: 42px;
    }
    
    .meta-info {
      margin-bottom: 16px;
      
      .meta-item {
        display: flex;
        align-items: center;
        margin-bottom: 6px;
        font-size: 12px;
        color: #999;
        
        .anticon {
          margin-right: 6px;
          font-size: 12px;
        }
        
        span {
          flex: 1;
        }
      }
    }
    
    .progress-section {
      .progress-label {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 4px;
        font-size: 12px;
        
        .progress-text {
          font-weight: 500;
          color: #1890ff;
        }
      }
    }
  }
  
  // 状态样式
  &.status-pending {
    border-left: 4px solid #faad14;
  }
  
  &.status-in_progress {
    border-left: 4px solid #1890ff;
  }
  
  &.status-testing {
    border-left: 4px solid #13c2c2;
  }
  
  &.status-completed {
    border-left: 4px solid #52c41a;
  }
  
  &.status-cancelled {
    border-left: 4px solid #f5222d;
  }
  
  &.status-on_hold {
    border-left: 4px solid #722ed1;
  }
  
  // 优先级样式
  &.priority-urgent {
    background: linear-gradient(135deg, #fff2f0 0%, #ffffff 100%);
  }
  
  &.priority-high {
    background: linear-gradient(135deg, #fff7e6 0%, #ffffff 100%);
  }
}
</style>
```

### 6.2 应用卡片组件

#### 功能特性
- 基于j-card组件展示应用信息
- 支持应用状态管理
- 集成快速操作菜单
- 响应式布局设计

```vue
<!-- ApplicationCard.vue -->
<template>
  <j-card hoverable class="application-card">
    <template #title>
      <div class="card-title">
        <Icon :icon="record.icon || 'ant-design:appstore-outlined'" class="app-icon" />
        <span class="title-text">{{ record.name }}</span>
        <j-tag :color="getStatusColor(record.status)">
          {{ getStatusText(record.status) }}
        </j-tag>
      </div>
    </template>
    
    <template #extra>
      <a-dropdown>
        <j-button type="text" size="small">
          <Icon icon="ant-design:more-outlined" />
        </j-button>
        <template #overlay>
          <a-menu @click="handleMenuClick">
            <a-menu-item key="view">
              <Icon icon="ant-design:eye-outlined" />
              查看详情
            </a-menu-item>
            <a-menu-item key="edit">
              <Icon icon="ant-design:edit-outlined" />
              编辑
            </a-menu-item>
            <a-menu-item key="deploy">
              <Icon icon="ant-design:cloud-upload-outlined" />
              部署
            </a-menu-item>
            <a-menu-divider />
            <a-menu-item key="delete" class="danger-item">
              <Icon icon="ant-design:delete-outlined" />
              删除
            </a-menu-item>
          </a-menu>
        </template>
      </a-dropdown>
    </template>
    
    <div class="card-content">
      <p class="description">{{ record.description || '暂无描述' }}</p>
      
      <div class="meta-info">
        <div class="meta-item">
          <Icon icon="ant-design:code-outlined" />
          <span>{{ record.framework || 'Unknown' }}</span>
        </div>
        <div class="meta-item">
          <Icon icon="ant-design:user-outlined" />
          <span>{{ record.ownerName || '未分配' }}</span>
        </div>
        <div class="meta-item">
          <Icon icon="ant-design:calendar-outlined" />
          <span>{{ formatDate(record.lastDeployTime) || '未部署' }}</span>
        </div>
        <div class="meta-item">
          <Icon icon="ant-design:global-outlined" />
          <a :href="record.url" target="_blank" v-if="record.url">
            访问应用
          </a>
          <span v-else class="text-gray">未配置</span>
        </div>
      </div>
    </div>
    
    <template #actions>
      <a key="requirements" @click="handleAction('requirements')">
        <Icon icon="ant-design:file-text-outlined" />
        需求 ({{ record.requirementCount || 0 }})
      </a>
      <a key="deploy" @click="handleAction('deploy')">
        <Icon icon="ant-design:rocket-outlined" />
        部署
      </a>
      <a key="settings" @click="handleAction('settings')">
        <Icon icon="ant-design:setting-outlined" />
        设置
      </a>
    </template>
  </j-card>
</template>

<script setup lang="ts">
import { Icon } from '/@/components/Icon'
import { useMessage } from '/@/hooks/web/useMessage'
import { formatDate } from '/@/utils/dateUtil'
import type { ApplicationRecord } from '/@/api/verto/model/applicationModel'

interface Props {
  record: ApplicationRecord
  index: number
}

interface Emits {
  (e: 'action', action: string, record: ApplicationRecord): void
  (e: 'menu-click', key: string, record: ApplicationRecord): void
}

const props = defineProps<Props>()
const emit = defineEmits<Emits>()
const { createMessage } = useMessage()

// 状态相关方法
function getStatusColor(status: string) {
  const colorMap = {
    'development': 'blue',
    'testing': 'orange',
    'production': 'green',
    'maintenance': 'purple',
    'archived': 'gray',
  }
  return colorMap[status] || 'default'
}

function getStatusText(status: string) {
  const textMap = {
    'development': '开发中',
    'testing': '测试中',
    'production': '生产环境',
    'maintenance': '维护中',
    'archived': '已归档',
  }
  return textMap[status] || status
}

// 事件处理
function handleAction(action: string) {
  emit('action', action, props.record)
}

function handleMenuClick({ key }: { key: string }) {
  emit('menu-click', key, props.record)
  
  const actionMap = {
    'view': '查看应用详情',
    'edit': '编辑应用',
    'deploy': '部署应用',
    'delete': '删除应用',
  }
  
  if (actionMap[key]) {
    createMessage.info(`正在${actionMap[key]}...`)
  }
}
</script>

<style scoped>
.application-card {
  height: 100%;
  transition: all 0.3s ease;
  
  &:hover {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  }
  
  .card-title {
    display: flex;
    align-items: center;
    gap: 8px;
    
    .app-icon {
      font-size: 18px;
      color: #1890ff;
    }
    
    .title-text {
      font-weight: 500;
      font-size: 14px;
      flex: 1;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
  }
  
  .card-content {
    .description {
      color: #666;
      margin-bottom: 16px;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      text-overflow: ellipsis;
      line-height: 1.5;
      min-height: 42px;
    }
    
    .meta-info {
      .meta-item {
        display: flex;
        align-items: center;
        margin-bottom: 6px;
        font-size: 12px;
        color: #999;
        
        .anticon {
          margin-right: 6px;
          font-size: 12px;
        }
        
        a {
          color: #1890ff;
          text-decoration: none;
          
          &:hover {
            text-decoration: underline;
          }
        }
        
        .text-gray {
          color: #ccc;
        }
      }
    }
  }
  
  :deep(.ant-card-actions) {
    .danger-item {
      color: #f5222d;
    }
  }
}
</style>
```

### 6.3 物料卡片组件

#### 功能特性
- 基于j-card组件展示物料信息
- 支持物料类型分类显示
- 集成版本管理功能
- 支持快速预览和下载

```vue
<!-- MaterialCard.vue -->
<template>
  <j-card hoverable class="material-card">
    <template #title>
      <div class="card-title">
        <Icon :icon="getMaterialIcon(record.type)" class="material-icon" />
        <span class="title-text">{{ record.name }}</span>
        <j-tag :color="getTypeColor(record.type)">
          {{ getTypeText(record.type) }}
        </j-tag>
      </div>
    </template>
    
    <template #extra>
      <a-dropdown>
        <j-button type="text" size="small">
          <Icon icon="ant-design:more-outlined" />
        </j-button>
        <template #overlay>
          <a-menu @click="handleMenuClick">
            <a-menu-item key="preview">
              <Icon icon="ant-design:eye-outlined" />
              预览
            </a-menu-item>
            <a-menu-item key="download">
              <Icon icon="ant-design:download-outlined" />
              下载
            </a-menu-item>
            <a-menu-item key="edit">
              <Icon icon="ant-design:edit-outlined" />
              编辑
            </a-menu-item>
            <a-menu-divider />
            <a-menu-item key="delete" class="danger-item">
              <Icon icon="ant-design:delete-outlined" />
              删除
            </a-menu-item>
          </a-menu>
        </template>
      </a-dropdown>
    </template>
    
    <div class="card-content">
      <p class="description">{{ record.description || '暂无描述' }}</p>
      
      <div class="meta-info">
        <div class="meta-item">
          <Icon icon="ant-design:tag-outlined" />
          <span>v{{ record.version || '1.0.0' }}</span>
        </div>
        <div class="meta-item">
          <Icon icon="ant-design:user-outlined" />
          <span>{{ record.authorName || '未知作者' }}</span>
        </div>
        <div class="meta-item">
          <Icon icon="ant-design:calendar-outlined" />
          <span>{{ formatDate(record.updateTime) || '未知时间' }}</span>
        </div>
        <div class="meta-item">
          <Icon icon="ant-design:file-outlined" />
          <span>{{ formatFileSize(record.fileSize) || '未知大小' }}</span>
        </div>
      </div>
      
      <!-- 标签 -->
      <div class="tags-section" v-if="record.tags && record.tags.length">
        <j-tag 
          v-for="tag in record.tags" 
          :key="tag" 
          size="small" 
          class="tag-item"
        >
          {{ tag }}
        </j-tag>
      </div>
    </div>
    
    <template #actions>
      <a key="preview" @click="handleAction('preview')">
        <Icon icon="ant-design:eye-outlined" />
        预览
      </a>
      <a key="use" @click="handleAction('use')">
        <Icon icon="ant-design:plus-outlined" />
        使用
      </a>
      <a key="download" @click="handleAction('download')">
        <Icon icon="ant-design:download-outlined" />
        下载
      </a>
    </template>
  </j-card>
</template>

<script setup lang="ts">
import { Icon } from '/@/components/Icon'
import { useMessage } from '/@/hooks/web/useMessage'
import { formatDate } from '/@/utils/dateUtil'
import type { MaterialRecord } from '/@/api/verto/model/materialModel'

interface Props {
  record: MaterialRecord
  index: number
}

interface Emits {
  (e: 'action', action: string, record: MaterialRecord): void
  (e: 'menu-click', key: string, record: MaterialRecord): void
}

const props = defineProps<Props>()
const emit = defineEmits<Emits>()
const { createMessage } = useMessage()

// 物料类型相关方法
function getMaterialIcon(type: string) {
  const iconMap = {
    'component': 'ant-design:appstore-outlined',
    'template': 'ant-design:file-text-outlined',
    'snippet': 'ant-design:code-outlined',
    'asset': 'ant-design:picture-outlined',
    'document': 'ant-design:book-outlined',
  }
  return iconMap[type] || 'ant-design:file-outlined'
}

function getTypeColor(type: string) {
  const colorMap = {
    'component': 'blue',
    'template': 'green',
    'snippet': 'orange',
    'asset': 'purple',
    'document': 'cyan',
  }
  return colorMap[type] || 'default'
}

function getTypeText(type: string) {
  const textMap = {
    'component': '组件',
    'template': '模板',
    'snippet': '代码片段',
    'asset': '资源',
    'document': '文档',
  }
  return textMap[type] || type
}

// 工具方法
function formatFileSize(bytes: number) {
  if (!bytes) return '0 B'
  const k = 1024
  const sizes = ['B', 'KB', 'MB', 'GB']
  const i = Math.floor(Math.log(bytes) / Math.log(k))
  return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i]
}

// 事件处理
function handleAction(action: string) {
  emit('action', action, props.record)
}

function handleMenuClick({ key }: { key: string }) {
  emit('menu-click', key, props.record)
  
  const actionMap = {
    'preview': '预览物料',
    'download': '下载物料',
    'edit': '编辑物料',
    'delete': '删除物料',
  }
  
  if (actionMap[key]) {
    createMessage.info(`正在${actionMap[key]}...`)
  }
}
</script>

<style scoped>
.material-card {
  height: 100%;
  transition: all 0.3s ease;
  
  &:hover {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  }
  
  .card-title {
    display: flex;
    align-items: center;
    gap: 8px;
    
    .material-icon {
      font-size: 18px;
      color: #1890ff;
    }
    
    .title-text {
      font-weight: 500;
      font-size: 14px;
      flex: 1;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
  }
  
  .card-content {
    .description {
      color: #666;
      margin-bottom: 16px;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      text-overflow: ellipsis;
      line-height: 1.5;
      min-height: 42px;
    }
    
    .meta-info {
      margin-bottom: 12px;
      
      .meta-item {
        display: flex;
        align-items: center;
        margin-bottom: 6px;
        font-size: 12px;
        color: #999;
        
        .anticon {
          margin-right: 6px;
          font-size: 12px;
        }
      }
    }
    
    .tags-section {
      .tag-item {
        margin-right: 4px;
        margin-bottom: 4px;
      }
    }
  }
  
  :deep(.ant-card-actions) {
    .danger-item {
      color: #f5222d;
    }
  }
}
</style>
```

### 6.4 人员卡片组件

#### 功能特性
- 基于j-card组件展示人员信息
- 支持角色和技能标签显示
- 集成工作负载统计
- 支持快速联系和分配任务

```vue
<!-- PersonCard.vue -->
<template>
  <j-card hoverable class="person-card">
    <template #title>
      <div class="card-title">
        <a-avatar 
          :src="record.avatar" 
          :size="32"
          class="person-avatar"
        >
          {{ record.name?.charAt(0) || 'U' }}
        </a-avatar>
        <div class="person-info">
          <span class="name">{{ record.name }}</span>
          <j-tag :color="getRoleColor(record.role)" size="small">
            {{ getRoleText(record.role) }}
          </j-tag>
        </div>
      </div>
    </template>
    
    <template #extra>
      <a-dropdown>
        <j-button type="text" size="small">
          <Icon icon="ant-design:more-outlined" />
        </j-button>
        <template #overlay>
          <a-menu @click="handleMenuClick">
            <a-menu-item key="profile">
              <Icon icon="ant-design:user-outlined" />
              查看资料
            </a-menu-item>
            <a-menu-item key="assign">
              <Icon icon="ant-design:plus-outlined" />
              分配任务
            </a-menu-item>
            <a-menu-item key="message">
              <Icon icon="ant-design:message-outlined" />
              发送消息
            </a-menu-item>
            <a-menu-divider />
            <a-menu-item key="edit">
              <Icon icon="ant-design:edit-outlined" />
              编辑信息
            </a-menu-item>
          </a-menu>
        </template>
      </a-dropdown>
    </template>
    
    <div class="card-content">
      <div class="contact-info">
        <div class="contact-item" v-if="record.email">
          <Icon icon="ant-design:mail-outlined" />
          <span>{{ record.email }}</span>
        </div>
        <div class="contact-item" v-if="record.phone">
          <Icon icon="ant-design:phone-outlined" />
          <span>{{ record.phone }}</span>
        </div>
        <div class="contact-item" v-if="record.department">
          <Icon icon="ant-design:team-outlined" />
          <span>{{ record.department }}</span>
        </div>
      </div>
      
      <!-- 技能标签 -->
      <div class="skills-section" v-if="record.skills && record.skills.length">
        <div class="section-title">技能</div>
        <div class="skills-list">
          <j-tag 
            v-for="skill in record.skills.slice(0, 4)" 
            :key="skill" 
            size="small" 
            class="skill-tag"
          >
            {{ skill }}
          </j-tag>
          <j-tag 
            v-if="record.skills.length > 4"
            size="small" 
            class="more-tag"
          >
            +{{ record.skills.length - 4 }}
          </j-tag>
        </div>
      </div>
      
      <!-- 工作负载 -->
      <div class="workload-section">
        <div class="section-title">工作负载</div>
        <div class="workload-stats">
          <div class="stat-item">
            <span class="stat-label">进行中</span>
            <span class="stat-value">{{ record.activeTaskCount || 0 }}</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">本月完成</span>
            <span class="stat-value">{{ record.completedTaskCount || 0 }}</span>
          </div>
        </div>
        <a-progress 
          :percent="getWorkloadPercent(record.activeTaskCount)" 
          size="small"
          :stroke-color="getWorkloadColor(record.activeTaskCount)"
          :show-info="false"
        />
      </div>
    </div>
    
    <template #actions>
      <a key="profile" @click="handleAction('profile')">
        <Icon icon="ant-design:user-outlined" />
        资料
      </a>
      <a key="assign" @click="handleAction('assign')">
        <Icon icon="ant-design:plus-outlined" />
        分配
      </a>
      <a key="contact" @click="handleAction('contact')">
        <Icon icon="ant-design:message-outlined" />
        联系
      </a>
    </template>
  </j-card>
</template>

<script setup lang="ts">
import { Icon } from '/@/components/Icon'
import { useMessage } from '/@/hooks/web/useMessage'
import type { PersonRecord } from '/@/api/verto/model/personModel'

interface Props {
  record: PersonRecord
  index: number
}

interface Emits {
  (e: 'action', action: string, record: PersonRecord): void
  (e: 'menu-click', key: string, record: PersonRecord): void
}

const props = defineProps<Props>()
const emit = defineEmits<Emits>()
const { createMessage } = useMessage()

// 角色相关方法
function getRoleColor(role: string) {
  const colorMap = {
    'admin': 'red',
    'manager': 'orange',
    'developer': 'blue',
    'designer': 'purple',
    'tester': 'green',
    'analyst': 'cyan',
  }
  return colorMap[role] || 'default'
}

function getRoleText(role: string) {
  const textMap = {
    'admin': '管理员',
    'manager': '项目经理',
    'developer': '开发工程师',
    'designer': '设计师',
    'tester': '测试工程师',
    'analyst': '业务分析师',
  }
  return textMap[role] || role
}

// 工作负载相关方法
function getWorkloadPercent(activeTaskCount: number) {
  // 假设最大工作负载为10个任务
  const maxTasks = 10
  return Math.min((activeTaskCount / maxTasks) * 100, 100)
}

function getWorkloadColor(activeTaskCount: number) {
  if (activeTaskCount <= 3) return '#52c41a' // 绿色 - 轻松
  if (activeTaskCount <= 6) return '#1890ff' // 蓝色 - 正常
  if (activeTaskCount <= 8) return '#faad14' // 橙色 - 繁忙
  return '#f5222d' // 红色 - 超负荷
}

// 事件处理
function handleAction(action: string) {
  emit('action', action, props.record)
}

function handleMenuClick({ key }: { key: string }) {
  emit('menu-click', key, props.record)
  
  const actionMap = {
    'profile': '查看人员资料',
    'assign': '分配任务',
    'message': '发送消息',
    'edit': '编辑人员信息',
  }
  
  if (actionMap[key]) {
    createMessage.info(`正在${actionMap[key]}...`)
  }
}
</script>

<style scoped>
.person-card {
  height: 100%;
  transition: all 0.3s ease;
  
  &:hover {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  }
  
  .card-title {
    display: flex;
    align-items: center;
    gap: 12px;
    
    .person-avatar {
      flex-shrink: 0;
    }
    
    .person-info {
      flex: 1;
      min-width: 0;
      
      .name {
        display: block;
        font-weight: 500;
        font-size: 14px;
        margin-bottom: 2px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }
    }
  }
  
  .card-content {
    .contact-info {
      margin-bottom: 16px;
      
      .contact-item {
        display: flex;
        align-items: center;
        margin-bottom: 6px;
        font-size: 12px;
        color: #666;
        
        .anticon {
          margin-right: 6px;
          font-size: 12px;
          color: #999;
        }
      }
    }
    
    .skills-section {
      margin-bottom: 16px;
      
      .section-title {
        font-size: 12px;
        color: #999;
        margin-bottom: 6px;
      }
      
      .skills-list {
        .skill-tag {
          margin-right: 4px;
          margin-bottom: 4px;
          background: #f0f2f5;
          border: none;
          color: #666;
        }
        
        .more-tag {
          background: #e6f7ff;
          border: 1px solid #91d5ff;
          color: #1890ff;
        }
      }
    }
    
    .workload-section {
      .section-title {
        font-size: 12px;
        color: #999;
        margin-bottom: 8px;
      }
      
      .workload-stats {
        display: flex;
        justify-content: space-between;
        margin-bottom: 8px;
        
        .stat-item {
          text-align: center;
          
          .stat-label {
            display: block;
            font-size: 11px;
            color: #999;
            margin-bottom: 2px;
          }
          
          .stat-value {
            font-size: 16px;
            font-weight: 500;
            color: #1890ff;
          }
        }
      }
    }
  }
}
</style>
```

## 7. 路由配置

### 7.1 路由结构设计

基于JeecgBoot的路由配置，设计Verto业务路由：

```typescript
// router/routes/modules/verto.ts
import type { AppRouteModule } from '/@/router/types'
import { LAYOUT } from '/@/router/constant'

const verto: AppRouteModule = {
  path: '/verto',
  name: 'Verto',
  component: LAYOUT,
  redirect: '/verto/dashboard',
  meta: {
    orderNo: 10,
    icon: 'ion:grid-outline',
    title: 'Verto平台',
  },
  children: [
    {
      path: 'dashboard',
      name: 'VertoDashboard',
      component: () => import('/@/views/verto/dashboard/index.vue'),
      meta: {
        title: '工作台',
        icon: 'ion:home-outline',
      },
    },
    {
      path: 'requirements',
      name: 'VertoRequirements',
      component: () => import('/@/views/verto/requirements/index.vue'),
      meta: {
        title: '需求管理',
        icon: 'ion:document-text-outline',
      },
    },
    {
      path: 'applications',
      name: 'VertoApplications',
      component: () => import('/@/views/verto/applications/index.vue'),
      meta: {
        title: '应用管理',
        icon: 'ion:apps-outline',
      },
    },
    {
      path: 'materials',
      name: 'VertoMaterials',
      component: () => import('/@/views/verto/materials/index.vue'),
      meta: {
        title: '物料管理',
        icon: 'ion:library-outline',
      },
    },
    {
      path: 'team',
      name: 'VertoTeam',
      component: () => import('/@/views/verto/team/index.vue'),
      meta: {
        title: '团队管理',
        icon: 'ion:people-outline',
      },
    },
  ],
}

export default verto
```

### 7.2 页面组件结构

```typescript
// views/verto/requirements/index.vue
<template>
  <PageWrapper dense contentFullHeight contentClass="flex">
    <RequirementTable class="w-1/2 xl:w-2/3" @register="registerTable" />
    <RequirementDetail class="w-1/2 xl:w-1/3" @register="registerDetail" />
  </PageWrapper>
</template>

<script setup lang="ts">
import { PageWrapper } from '/@/components/Page'
import RequirementTable from './components/RequirementTable.vue'
import RequirementDetail from './components/RequirementDetail.vue'
import { useTable } from '/@/components/Table'
import { useDrawer } from '/@/components/Drawer'

const [registerTable] = useTable({
  title: '需求列表',
  api: getRequirementList,
  columns: requirementColumns,
  formConfig: {
    labelWidth: 120,
    schemas: requirementSearchFormSchema,
  },
  useSearchForm: true,
  showTableSetting: true,
  bordered: true,
  actionColumn: {
    width: 120,
    title: '操作',
    dataIndex: 'action',
    slots: { customRender: 'action' },
  },
})

const [registerDetail] = useDrawer()
</script>
```

## 8. 状态管理

### 8.1 Pinia Store 设计

基于JeecgBoot的状态管理模式，设计Verto业务状态：

```typescript
// store/modules/verto.ts
import { defineStore } from 'pinia'
import { store } from '/@/store'
import type { RequirementInfo, ApplicationInfo, MaterialInfo } from '/@/api/verto/model'

interface VertoState {
  // 当前选中的需求
  currentRequirement: RequirementInfo | null
  // 当前选中的应用
  currentApplication: ApplicationInfo | null
  // 当前选中的物料
  currentMaterial: MaterialInfo | null
  // 工作台统计数据
  dashboardStats: {
    requirementCount: number
    applicationCount: number
    materialCount: number
    teamMemberCount: number
  }
  // 用户偏好设置
  userPreferences: {
    cardViewMode: 'grid' | 'list'
    pageSize: number
    sortBy: string
    sortOrder: 'asc' | 'desc'
  }
}

export const useVertoStore = defineStore({
  id: 'app-verto',
  state: (): VertoState => ({
    currentRequirement: null,
    currentApplication: null,
    currentMaterial: null,
    dashboardStats: {
      requirementCount: 0,
      applicationCount: 0,
      materialCount: 0,
      teamMemberCount: 0,
    },
    userPreferences: {
      cardViewMode: 'grid',
      pageSize: 20,
      sortBy: 'updateTime',
      sortOrder: 'desc',
    },
  }),
  
  getters: {
    getCurrentRequirement(): RequirementInfo | null {
      return this.currentRequirement
    },
    
    getCurrentApplication(): ApplicationInfo | null {
      return this.currentApplication
    },
    
    getCurrentMaterial(): MaterialInfo | null {
      return this.currentMaterial
    },
    
    getDashboardStats(): VertoState['dashboardStats'] {
      return this.dashboardStats
    },
    
    getUserPreferences(): VertoState['userPreferences'] {
      return this.userPreferences
    },
  },
  
  actions: {
    // 设置当前需求
    setCurrentRequirement(requirement: RequirementInfo | null) {
      this.currentRequirement = requirement
    },
    
    // 设置当前应用
    setCurrentApplication(application: ApplicationInfo | null) {
      this.currentApplication = application
    },
    
    // 设置当前物料
    setCurrentMaterial(material: MaterialInfo | null) {
      this.currentMaterial = material
    },
    
    // 更新工作台统计数据
    async updateDashboardStats() {
      try {
        const stats = await getDashboardStatsApi()
        this.dashboardStats = stats
      } catch (error) {
        console.error('Failed to update dashboard stats:', error)
      }
    },
    
    // 更新用户偏好设置
    updateUserPreferences(preferences: Partial<VertoState['userPreferences']>) {
      this.userPreferences = { ...this.userPreferences, ...preferences }
      // 持久化到本地存储
      localStorage.setItem('verto-user-preferences', JSON.stringify(this.userPreferences))
    },
    
    // 从本地存储加载用户偏好设置
    loadUserPreferences() {
      const saved = localStorage.getItem('verto-user-preferences')
      if (saved) {
        try {
          this.userPreferences = { ...this.userPreferences, ...JSON.parse(saved) }
        } catch (error) {
          console.error('Failed to load user preferences:', error)
        }
      }
    },
    
    // 重置状态
    resetState() {
      this.currentRequirement = null
      this.currentApplication = null
      this.currentMaterial = null
      this.dashboardStats = {
        requirementCount: 0,
        applicationCount: 0,
        materialCount: 0,
        teamMemberCount: 0,
      }
    },
  },
})

// 在setup外使用
export function useVertoStoreWithOut() {
  return useVertoStore(store)
}
```

### 8.2 组合式API封装

```typescript
// hooks/verto/useRequirement.ts
import { ref, computed } from 'vue'
import { useVertoStore } from '/@/store/modules/verto'
import { useMessage } from '/@/hooks/web/useMessage'
import type { RequirementInfo, CreateRequirementParams } from '/@/api/verto/model'
import { 
  getRequirementListApi, 
  createRequirementApi, 
  updateRequirementApi, 
  deleteRequirementApi 
} from '/@/api/verto/requirement'

export function useRequirement() {
  const vertoStore = useVertoStore()
  const { createMessage } = useMessage()
  
  const loading = ref(false)
  const requirements = ref<RequirementInfo[]>([])
  
  // 计算属性
  const currentRequirement = computed(() => vertoStore.getCurrentRequirement)
  
  // 获取需求列表
  async function fetchRequirements(params = {}) {
    loading.value = true
    try {
      const result = await getRequirementListApi(params)
      requirements.value = result.items
      return result
    } catch (error) {
      createMessage.error('获取需求列表失败')
      throw error
    } finally {
      loading.value = false
    }
  }
  
  // 创建需求
  async function createRequirement(params: CreateRequirementParams) {
    loading.value = true
    try {
      const result = await createRequirementApi(params)
      createMessage.success('创建需求成功')
      await fetchRequirements() // 刷新列表
      return result
    } catch (error) {
      createMessage.error('创建需求失败')
      throw error
    } finally {
      loading.value = false
    }
  }
  
  // 更新需求
  async function updateRequirement(id: string, params: Partial<RequirementInfo>) {
    loading.value = true
    try {
      const result = await updateRequirementApi(id, params)
      createMessage.success('更新需求成功')
      await fetchRequirements() // 刷新列表
      return result
    } catch (error) {
      createMessage.error('更新需求失败')
      throw error
    } finally {
      loading.value = false
    }
  }
  
  // 删除需求
  async function deleteRequirement(id: string) {
    loading.value = true
    try {
      await deleteRequirementApi(id)
      createMessage.success('删除需求成功')
      await fetchRequirements() // 刷新列表
    } catch (error) {
      createMessage.error('删除需求失败')
      throw error
    } finally {
      loading.value = false
    }
  }
  
  // 选择需求
  function selectRequirement(requirement: RequirementInfo | null) {
    vertoStore.setCurrentRequirement(requirement)
  }
  
  return {
    loading: readonly(loading),
    requirements: readonly(requirements),
    currentRequirement,
    fetchRequirements,
    createRequirement,
    updateRequirement,
    deleteRequirement,
    selectRequirement,
  }
}
```

## 9. 工具函数和类型定义

### 9.1 通用工具函数

```typescript
// utils/verto.ts
import { formatToDateTime } from '/@/utils/dateUtil'
import type { RequirementInfo, ApplicationInfo, MaterialInfo } from '/@/api/verto/model'

/**
 * 格式化需求状态
 */
export function formatRequirementStatus(status: string): { text: string; color: string } {
  const statusMap = {
    'draft': { text: '草稿', color: 'default' },
    'pending': { text: '待审核', color: 'orange' },
    'approved': { text: '已审核', color: 'blue' },
    'in_progress': { text: '进行中', color: 'processing' },
    'testing': { text: '测试中', color: 'cyan' },
    'completed': { text: '已完成', color: 'success' },
    'cancelled': { text: '已取消', color: 'error' },
  }
  return statusMap[status] || { text: status, color: 'default' }
}

/**
 * 格式化优先级
 */
export function formatPriority(priority: string): { text: string; color: string } {
  const priorityMap = {
    'low': { text: '低', color: 'green' },
    'medium': { text: '中', color: 'orange' },
    'high': { text: '高', color: 'red' },
    'urgent': { text: '紧急', color: 'magenta' },
  }
  return priorityMap[priority] || { text: priority, color: 'default' }
}

/**
 * 计算需求进度
 */
export function calculateRequirementProgress(requirement: RequirementInfo): number {
  const { status } = requirement
  const progressMap = {
    'draft': 0,
    'pending': 10,
    'approved': 20,
    'in_progress': 50,
    'testing': 80,
    'completed': 100,
    'cancelled': 0,
  }
  return progressMap[status] || 0
}

/**
 * 生成唯一ID
 */
export function generateId(prefix = ''): string {
  const timestamp = Date.now().toString(36)
  const random = Math.random().toString(36).substr(2, 5)
  return `${prefix}${timestamp}${random}`
}

/**
 * 文件大小格式化
 */
export function formatFileSize(bytes: number): string {
  if (bytes === 0) return '0 B'
  const k = 1024
  const sizes = ['B', 'KB', 'MB', 'GB', 'TB']
  const i = Math.floor(Math.log(bytes) / Math.log(k))
  return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i]
}

/**
 * 深度克隆对象
 */
export function deepClone<T>(obj: T): T {
  if (obj === null || typeof obj !== 'object') return obj
  if (obj instanceof Date) return new Date(obj.getTime()) as unknown as T
  if (obj instanceof Array) return obj.map(item => deepClone(item)) as unknown as T
  if (typeof obj === 'object') {
    const clonedObj = {} as T
    for (const key in obj) {
      if (obj.hasOwnProperty(key)) {
        clonedObj[key] = deepClone(obj[key])
      }
    }
    return clonedObj
  }
  return obj
}
```

### 9.2 业务类型定义

```typescript
// types/verto.ts

// 基础实体接口
export interface BaseEntity {
  id: string
  createTime: string
  updateTime: string
  createBy: string
  updateBy: string
}

// 需求相关类型
export interface RequirementInfo extends BaseEntity {
  title: string
  description: string
  status: RequirementStatus
  priority: Priority
  assigneeId: string
  assigneeName: string
  reporterId: string
  reporterName: string
  estimatedHours: number
  actualHours: number
  tags: string[]
  attachments: AttachmentInfo[]
  comments: CommentInfo[]
}

export type RequirementStatus = 
  | 'draft' 
  | 'pending' 
  | 'approved' 
  | 'in_progress' 
  | 'testing' 
  | 'completed' 
  | 'cancelled'

export type Priority = 'low' | 'medium' | 'high' | 'urgent'

// 应用相关类型
export interface ApplicationInfo extends BaseEntity {
  name: string
  description: string
  version: string
  status: ApplicationStatus
  repositoryUrl: string
  deployUrl: string
  technologies: string[]
  requirements: string[] // 关联的需求ID
  materials: string[] // 使用的物料ID
  teamMembers: string[] // 团队成员ID
}

export type ApplicationStatus = 
  | 'planning' 
  | 'development' 
  | 'testing' 
  | 'staging' 
  | 'production' 
  | 'maintenance'

// 物料相关类型
export interface MaterialInfo extends BaseEntity {
  name: string
  description: string
  type: MaterialType
  version: string
  authorId: string
  authorName: string
  fileUrl: string
  fileSize: number
  downloadCount: number
  tags: string[]
  dependencies: string[]
  screenshots: string[]
}

export type MaterialType = 
  | 'component' 
  | 'template' 
  | 'snippet' 
  | 'asset' 
  | 'document'

// 人员相关类型
export interface PersonInfo extends BaseEntity {
  name: string
  email: string
  phone: string
  avatar: string
  role: PersonRole
  department: string
  skills: string[]
  activeTaskCount: number
  completedTaskCount: number
}

export type PersonRole = 
  | 'admin' 
  | 'manager' 
  | 'developer' 
  | 'designer' 
  | 'tester' 
  | 'analyst'

// 通用类型
export interface AttachmentInfo {
  id: string
  name: string
  url: string
  size: number
  type: string
  uploadTime: string
}

export interface CommentInfo {
  id: string
  content: string
  authorId: string
  authorName: string
  createTime: string
  parentId?: string
  replies?: CommentInfo[]
}

// API响应类型
export interface ApiResponse<T = any> {
  success: boolean
  message: string
  code: number
  result: T
  timestamp: number
}

export interface PageResult<T = any> {
  items: T[]
  total: number
  page: number
  pageSize: number
}

// 表单相关类型
export interface SearchParams {
  keyword?: string
  status?: string
  priority?: string
  assigneeId?: string
  dateRange?: [string, string]
  page?: number
  pageSize?: number
  sortBy?: string
  sortOrder?: 'asc' | 'desc'
}

export interface CreateRequirementParams {
  title: string
  description: string
  priority: Priority
  assigneeId: string
  estimatedHours: number
  tags: string[]
}

export interface UpdateRequirementParams extends Partial<CreateRequirementParams> {
  status?: RequirementStatus
  actualHours?: number
}
```

## 10. API接口设计

### 10.1 基础API配置

基于JeecgBoot的API模式，设计统一的接口调用：

```typescript
// api/verto/base.ts
import { defHttp } from '/@/utils/http/axios'
import type { ApiResponse, PageResult } from '/@/types/verto'

// API基础路径
const API_BASE = '/verto'

// 通用API封装
export class BaseApi<T = any> {
  private baseUrl: string

  constructor(module: string) {
    this.baseUrl = `${API_BASE}/${module}`
  }

  // 获取列表
  async getList(params = {}): Promise<PageResult<T>> {
    return defHttp.get<ApiResponse<PageResult<T>>>({
      url: `${this.baseUrl}/list`,
      params,
    }).then(res => res.result)
  }

  // 获取详情
  async getById(id: string): Promise<T> {
    return defHttp.get<ApiResponse<T>>({
      url: `${this.baseUrl}/${id}`,
    }).then(res => res.result)
  }

  // 创建
  async create(data: Partial<T>): Promise<T> {
    return defHttp.post<ApiResponse<T>>({
      url: `${this.baseUrl}`,
      data,
    }).then(res => res.result)
  }

  // 更新
  async update(id: string, data: Partial<T>): Promise<T> {
    return defHttp.put<ApiResponse<T>>({
      url: `${this.baseUrl}/${id}`,
      data,
    }).then(res => res.result)
  }

  // 删除
  async delete(id: string): Promise<void> {
    return defHttp.delete<ApiResponse<void>>({
      url: `${this.baseUrl}/${id}`,
    }).then(res => res.result)
  }

  // 批量删除
  async batchDelete(ids: string[]): Promise<void> {
    return defHttp.delete<ApiResponse<void>>({
      url: `${this.baseUrl}/batch`,
      data: { ids },
    }).then(res => res.result)
  }
}
```

### 10.2 具体业务API

```typescript
// api/verto/requirement.ts
import { BaseApi } from './base'
import type { RequirementInfo, CreateRequirementParams, UpdateRequirementParams } from '/@/types/verto'
import { defHttp } from '/@/utils/http/axios'

class RequirementApi extends BaseApi<RequirementInfo> {
  constructor() {
    super('requirements')
  }

  // 更新需求状态
  async updateStatus(id: string, status: string): Promise<RequirementInfo> {
    return defHttp.patch<ApiResponse<RequirementInfo>>({
      url: `${this.baseUrl}/${id}/status`,
      data: { status },
    }).then(res => res.result)
  }

  // 分配需求
  async assign(id: string, assigneeId: string): Promise<RequirementInfo> {
    return defHttp.patch<ApiResponse<RequirementInfo>>({
      url: `${this.baseUrl}/${id}/assign`,
      data: { assigneeId },
    }).then(res => res.result)
  }

  // 添加评论
  async addComment(id: string, content: string): Promise<CommentInfo> {
    return defHttp.post<ApiResponse<CommentInfo>>({
      url: `${this.baseUrl}/${id}/comments`,
      data: { content },
    }).then(res => res.result)
  }

  // 上传附件
  async uploadAttachment(id: string, file: File): Promise<AttachmentInfo> {
    const formData = new FormData()
    formData.append('file', file)
    return defHttp.uploadFile<ApiResponse<AttachmentInfo>>({
      url: `${this.baseUrl}/${id}/attachments`,
      data: formData,
    }).then(res => res.result)
  }
}

export const requirementApi = new RequirementApi()

// 导出具体方法
export const getRequirementListApi = requirementApi.getList.bind(requirementApi)
export const getRequirementByIdApi = requirementApi.getById.bind(requirementApi)
export const createRequirementApi = requirementApi.create.bind(requirementApi)
export const updateRequirementApi = requirementApi.update.bind(requirementApi)
export const deleteRequirementApi = requirementApi.delete.bind(requirementApi)
export const updateRequirementStatusApi = requirementApi.updateStatus.bind(requirementApi)
export const assignRequirementApi = requirementApi.assign.bind(requirementApi)
export const addRequirementCommentApi = requirementApi.addComment.bind(requirementApi)
export const uploadRequirementAttachmentApi = requirementApi.uploadAttachment.bind(requirementApi)
```

### 10.3 统计数据API

```typescript
// api/verto/dashboard.ts
import { defHttp } from '/@/utils/http/axios'
import type { ApiResponse } from '/@/types/verto'

export interface DashboardStats {
  requirementCount: number
  applicationCount: number
  materialCount: number
  teamMemberCount: number
  recentActivities: ActivityInfo[]
  statusDistribution: StatusDistribution[]
  priorityDistribution: PriorityDistribution[]
}

export interface ActivityInfo {
  id: string
  type: 'requirement' | 'application' | 'material'
  action: string
  title: string
  userName: string
  createTime: string
}

export interface StatusDistribution {
  status: string
  count: number
  percentage: number
}

export interface PriorityDistribution {
  priority: string
  count: number
  percentage: number
}

// 获取工作台统计数据
export function getDashboardStatsApi(): Promise<DashboardStats> {
  return defHttp.get<ApiResponse<DashboardStats>>({
    url: '/verto/dashboard/stats',
  }).then(res => res.result)
}

// 获取最近活动
export function getRecentActivitiesApi(limit = 10): Promise<ActivityInfo[]> {
  return defHttp.get<ApiResponse<ActivityInfo[]>>({
    url: '/verto/dashboard/activities',
    params: { limit },
  }).then(res => res.result)
}

// 获取状态分布
export function getStatusDistributionApi(type: string): Promise<StatusDistribution[]> {
  return defHttp.get<ApiResponse<StatusDistribution[]>>({
    url: '/verto/dashboard/status-distribution',
    params: { type },
  }).then(res => res.result)
}
```

## 11. 组件配置示例

### 11.1 表格配置

```typescript
// config/requirement-table.ts
import type { BasicColumn, FormSchema } from '/@/components/Table'
import { formatRequirementStatus, formatPriority } from '/@/utils/verto'
import { Tag } from 'ant-design-vue'
import { h } from 'vue'

// 需求列表表格列配置
export const requirementColumns: BasicColumn[] = [
  {
    title: '需求标题',
    dataIndex: 'title',
    width: 200,
    align: 'left',
    customRender: ({ record }) => {
      return h('a', {
        onClick: () => handleViewDetail(record.id),
        class: 'text-blue-600 hover:text-blue-800',
      }, record.title)
    },
  },
  {
    title: '状态',
    dataIndex: 'status',
    width: 100,
    customRender: ({ record }) => {
      const { text, color } = formatRequirementStatus(record.status)
      return h(Tag, { color }, () => text)
    },
  },
  {
    title: '优先级',
    dataIndex: 'priority',
    width: 80,
    customRender: ({ record }) => {
      const { text, color } = formatPriority(record.priority)
      return h(Tag, { color }, () => text)
    },
  },
  {
    title: '负责人',
    dataIndex: 'assigneeName',
    width: 120,
  },
  {
    title: '报告人',
    dataIndex: 'reporterName',
    width: 120,
  },
  {
    title: '预估工时',
    dataIndex: 'estimatedHours',
    width: 100,
    customRender: ({ record }) => `${record.estimatedHours}h`,
  },
  {
    title: '实际工时',
    dataIndex: 'actualHours',
    width: 100,
    customRender: ({ record }) => `${record.actualHours || 0}h`,
  },
  {
    title: '创建时间',
    dataIndex: 'createTime',
    width: 150,
    sorter: true,
  },
  {
    title: '更新时间',
    dataIndex: 'updateTime',
    width: 150,
    sorter: true,
  },
]

// 搜索表单配置
export const requirementSearchFormSchema: FormSchema[] = [
  {
    field: 'keyword',
    label: '关键词',
    component: 'Input',
    componentProps: {
      placeholder: '请输入需求标题或描述',
    },
    colProps: { span: 6 },
  },
  {
    field: 'status',
    label: '状态',
    component: 'Select',
    componentProps: {
      placeholder: '请选择状态',
      options: [
        { label: '草稿', value: 'draft' },
        { label: '待审核', value: 'pending' },
        { label: '已审核', value: 'approved' },
        { label: '进行中', value: 'in_progress' },
        { label: '测试中', value: 'testing' },
        { label: '已完成', value: 'completed' },
        { label: '已取消', value: 'cancelled' },
      ],
    },
    colProps: { span: 6 },
  },
  {
    field: 'priority',
    label: '优先级',
    component: 'Select',
    componentProps: {
      placeholder: '请选择优先级',
      options: [
        { label: '低', value: 'low' },
        { label: '中', value: 'medium' },
        { label: '高', value: 'high' },
        { label: '紧急', value: 'urgent' },
      ],
    },
    colProps: { span: 6 },
  },
  {
    field: 'assigneeId',
    label: '负责人',
    component: 'JSelectUser',
    componentProps: {
      placeholder: '请选择负责人',
      labelInValue: true,
    },
    colProps: { span: 6 },
  },
  {
    field: 'dateRange',
    label: '创建时间',
    component: 'RangePicker',
    componentProps: {
      placeholder: ['开始时间', '结束时间'],
      showTime: true,
    },
    colProps: { span: 8 },
  },
]
```

### 11.2 表单配置

```typescript
// config/requirement-form.ts
import type { FormSchema } from '/@/components/Form'
import { validateRequired } from '/@/utils/validate'

// 需求创建/编辑表单配置
export const requirementFormSchema: FormSchema[] = [
  {
    field: 'title',
    label: '需求标题',
    component: 'Input',
    required: true,
    componentProps: {
      placeholder: '请输入需求标题',
      maxlength: 100,
      showCount: true,
    },
    rules: [
      { required: true, message: '请输入需求标题' },
      { min: 5, max: 100, message: '标题长度应在5-100个字符之间' },
    ],
  },
  {
    field: 'description',
    label: '需求描述',
    component: 'JEditor',
    required: true,
    componentProps: {
      placeholder: '请详细描述需求内容',
      height: 300,
    },
    rules: [
      { required: true, message: '请输入需求描述' },
      { min: 20, message: '描述至少需要20个字符' },
    ],
  },
  {
    field: 'priority',
    label: '优先级',
    component: 'RadioGroup',
    required: true,
    defaultValue: 'medium',
    componentProps: {
      options: [
        { label: '低', value: 'low' },
        { label: '中', value: 'medium' },
        { label: '高', value: 'high' },
        { label: '紧急', value: 'urgent' },
      ],
    },
    rules: [{ required: true, message: '请选择优先级' }],
  },
  {
    field: 'assigneeId',
    label: '负责人',
    component: 'JSelectUser',
    required: true,
    componentProps: {
      placeholder: '请选择负责人',
      labelInValue: true,
    },
    rules: [{ required: true, message: '请选择负责人' }],
  },
  {
    field: 'estimatedHours',
    label: '预估工时',
    component: 'InputNumber',
    required: true,
    componentProps: {
      placeholder: '请输入预估工时',
      min: 0.5,
      max: 1000,
      step: 0.5,
      precision: 1,
      addonAfter: '小时',
    },
    rules: [
      { required: true, message: '请输入预估工时' },
      { type: 'number', min: 0.5, max: 1000, message: '工时应在0.5-1000小时之间' },
    ],
  },
  {
    field: 'tags',
    label: '标签',
    component: 'Select',
    componentProps: {
      mode: 'tags',
      placeholder: '请输入或选择标签',
      options: [
        { label: '功能开发', value: '功能开发' },
        { label: '性能优化', value: '性能优化' },
        { label: '界面优化', value: '界面优化' },
        { label: '问题修复', value: '问题修复' },
        { label: '技术债务', value: '技术债务' },
      ],
      maxTagCount: 5,
    },
  },
  {
    field: 'attachments',
    label: '附件',
    component: 'JUpload',
    componentProps: {
      fileType: 'all',
      maxCount: 10,
      maxSize: 50, // MB
      text: '点击或拖拽文件到此区域上传',
      bizPath: 'verto/requirements',
    },
  },
]
```

### 11.3 卡片列表配置

```typescript
// config/requirement-card.ts
import type { CardListProps } from '/@/components/CardList'
import { requirementSearchFormSchema } from './requirement-form'
import { getRequirementListApi } from '/@/api/verto/requirement'

// 需求卡片列表配置
export const requirementCardConfig: CardListProps = {
  // API配置
  api: getRequirementListApi,
  
  // 搜索表单配置
  searchFormConfig: {
    schemas: requirementSearchFormSchema,
    labelWidth: 80,
    baseColProps: { span: 6 },
    actionColOptions: { span: 6 },
    autoSubmitOnEnter: true,
    submitOnReset: true,
  },
  
  // 卡片配置
  cardConfig: {
    size: 'default',
    hoverable: true,
    bordered: true,
    bodyStyle: { padding: '16px' },
  },
  
  // 网格配置
  gridConfig: {
    gutter: [16, 16],
    xs: 1,
    sm: 2,
    md: 3,
    lg: 4,
    xl: 4,
    xxl: 5,
  },
  
  // 分页配置
  pagination: {
    current: 1,
    pageSize: 20,
    showSizeChanger: true,
    showQuickJumper: true,
    showTotal: (total, range) => `第 ${range[0]}-${range[1]} 条/共 ${total} 条`,
    pageSizeOptions: ['10', '20', '50', '100'],
  },
  
  // 操作按钮配置
  actionConfig: {
    showEdit: true,
    showDelete: true,
    showView: true,
    customActions: [
      {
        label: '分配',
        icon: 'ant-design:user-add-outlined',
        color: 'primary',
        onClick: (record) => handleAssign(record),
      },
      {
        label: '复制',
        icon: 'ant-design:copy-outlined',
        onClick: (record) => handleCopy(record),
      },
    ],
  },
  
  // 工具栏配置
  toolbarConfig: {
    showRefresh: true,
    showDensity: true,
    showColumnSetting: false,
    showFullscreen: true,
    title: '需求管理',
    titleTooltip: '管理项目需求，包括创建、编辑、分配和跟踪需求状态',
  },
}
```

## 12. 开发规范和最佳实践

### 12.1 代码规范

#### 12.1.1 文件命名规范

```typescript
// 组件文件命名：PascalCase
RequirementCard.vue
ApplicationList.vue
MaterialUpload.vue

// 工具函数文件命名：camelCase
vertoUtils.ts
requirementHelper.ts
formValidator.ts

// 类型定义文件命名：camelCase
vertoTypes.ts
requirementModel.ts
apiResponse.ts

// 配置文件命名：kebab-case
requirement-table.ts
application-form.ts
material-card.ts
```

#### 12.1.2 组件结构规范

```vue
<!-- 标准Vue组件结构 -->
<template>
  <!-- 模板内容 -->
</template>

<script setup lang="ts">
// 1. 导入第三方库
import { ref, computed, onMounted } from 'vue'
import { useRouter } from 'vue-router'
import { message } from 'ant-design-vue'

// 2. 导入项目内部模块
import { useVertoStore } from '/@/store/modules/verto'
import { getRequirementListApi } from '/@/api/verto/requirement'
import type { RequirementInfo } from '/@/types/verto'

// 3. 定义接口和类型
interface Props {
  id?: string
  mode?: 'view' | 'edit'
}

interface Emits {
  (e: 'update', data: RequirementInfo): void
  (e: 'delete', id: string): void
}

// 4. 定义Props和Emits
const props = withDefaults(defineProps<Props>(), {
  mode: 'view',
})

const emit = defineEmits<Emits>()

// 5. 响应式数据
const loading = ref(false)
const data = ref<RequirementInfo[]>([])

// 6. 计算属性
const filteredData = computed(() => {
  return data.value.filter(item => item.status !== 'deleted')
})

// 7. 方法定义
const fetchData = async () => {
  loading.value = true
  try {
    const result = await getRequirementListApi()
    data.value = result.items
  } catch (error) {
    message.error('获取数据失败')
  } finally {
    loading.value = false
  }
}

// 8. 生命周期钩子
onMounted(() => {
  fetchData()
})

// 9. 暴露给父组件的方法
defineExpose({
  fetchData,
  refresh: fetchData,
})
</script>

<style scoped>
/* 组件样式 */
.requirement-card {
  @apply border rounded-lg p-4 hover:shadow-md transition-shadow;
}

.requirement-title {
  @apply text-lg font-semibold text-gray-800 mb-2;
}

.requirement-meta {
  @apply text-sm text-gray-500 space-x-2;
}
</style>
```

#### 12.1.3 TypeScript规范

```typescript
// 接口定义规范
export interface RequirementInfo {
  /** 需求ID */
  id: string
  /** 需求标题 */
  title: string
  /** 需求描述 */
  description: string
  /** 需求状态 */
  status: RequirementStatus
  /** 优先级 */
  priority: Priority
  /** 负责人ID */
  assigneeId: string
  /** 负责人姓名 */
  assigneeName: string
  /** 创建时间 */
  createTime: string
  /** 更新时间 */
  updateTime: string
}

// 枚举定义规范
export enum RequirementStatus {
  /** 草稿 */
  DRAFT = 'draft',
  /** 待审核 */
  PENDING = 'pending',
  /** 已审核 */
  APPROVED = 'approved',
  /** 进行中 */
  IN_PROGRESS = 'in_progress',
  /** 测试中 */
  TESTING = 'testing',
  /** 已完成 */
  COMPLETED = 'completed',
  /** 已取消 */
  CANCELLED = 'cancelled',
}

// 函数定义规范
/**
 * 格式化需求状态显示文本
 * @param status 需求状态
 * @returns 格式化后的状态信息
 */
export function formatRequirementStatus(status: RequirementStatus): {
  text: string
  color: string
} {
  const statusMap = {
    [RequirementStatus.DRAFT]: { text: '草稿', color: 'default' },
    [RequirementStatus.PENDING]: { text: '待审核', color: 'orange' },
    [RequirementStatus.APPROVED]: { text: '已审核', color: 'blue' },
    [RequirementStatus.IN_PROGRESS]: { text: '进行中', color: 'processing' },
    [RequirementStatus.TESTING]: { text: '测试中', color: 'cyan' },
    [RequirementStatus.COMPLETED]: { text: '已完成', color: 'success' },
    [RequirementStatus.CANCELLED]: { text: '已取消', color: 'error' },
  }
  
  return statusMap[status] || { text: status, color: 'default' }
}
```

### 12.2 性能优化最佳实践

#### 12.2.1 组件懒加载

```typescript
// 路由懒加载
const routes = [
  {
    path: '/verto/requirements',
    name: 'VertoRequirements',
    component: () => import('/@/views/verto/requirements/index.vue'),
    meta: {
      title: '需求管理',
    },
  },
]

// 组件懒加载
const RequirementDetail = defineAsyncComponent({
  loader: () => import('./components/RequirementDetail.vue'),
  loadingComponent: () => h('div', { class: 'loading' }, '加载中...'),
  errorComponent: () => h('div', { class: 'error' }, '加载失败'),
  delay: 200,
  timeout: 3000,
})
```

#### 12.2.2 虚拟滚动

```vue
<template>
  <div class="virtual-list-container">
    <VirtualList
      :data="requirements"
      :item-height="120"
      :container-height="600"
      :buffer="5"
    >
      <template #default="{ item, index }">
        <RequirementCard
          :key="item.id"
          :data="item"
          :index="index"
          @click="handleCardClick(item)"
        />
      </template>
    </VirtualList>
  </div>
</template>

<script setup lang="ts">
import { VirtualList } from '@tanstack/vue-virtual'
import RequirementCard from './RequirementCard.vue'

// 大数据量列表使用虚拟滚动
const requirements = ref<RequirementInfo[]>([])

const handleCardClick = (item: RequirementInfo) => {
  // 处理卡片点击事件
}
</script>
```

#### 12.2.3 缓存策略

```typescript
// API缓存
import { useMemoize } from '@vueuse/core'

/**
 * 带缓存的需求列表获取
 */
export const getCachedRequirementList = useMemoize(
  async (params: SearchParams) => {
    return await getRequirementListApi(params)
  },
  {
    // 缓存键生成函数
    getKey: (params) => JSON.stringify(params),
    // 缓存时间：5分钟
    maxAge: 5 * 60 * 1000,
  }
)

// 组件级缓存
const RequirementCard = defineComponent({
  name: 'RequirementCard',
  // 使用KeepAlive缓存组件实例
  __hmrId: 'RequirementCard',
  setup(props) {
    // 组件逻辑
  },
})
```

### 12.3 错误处理和用户体验

#### 12.3.1 统一错误处理

```typescript
// 全局错误处理
import { createApp } from 'vue'
import { message } from 'ant-design-vue'

const app = createApp(App)

// 全局错误处理器
app.config.errorHandler = (error, instance, info) => {
  console.error('Global error:', error, info)
  
  // 根据错误类型显示不同的提示
  if (error.name === 'ChunkLoadError') {
    message.error('页面资源加载失败，请刷新页面重试')
  } else if (error.message.includes('Network Error')) {
    message.error('网络连接异常，请检查网络设置')
  } else {
    message.error('系统异常，请联系管理员')
  }
}

// API错误处理
export class ApiErrorHandler {
  /**
   * 处理API错误
   * @param error 错误对象
   * @param showMessage 是否显示错误消息
   */
  static handle(error: any, showMessage = true): void {
    let errorMessage = '操作失败'
    
    if (error.response) {
      const { status, data } = error.response
      
      switch (status) {
        case 400:
          errorMessage = data.message || '请求参数错误'
          break
        case 401:
          errorMessage = '登录已过期，请重新登录'
          // 跳转到登录页
          router.push('/login')
          break
        case 403:
          errorMessage = '没有权限执行此操作'
          break
        case 404:
          errorMessage = '请求的资源不存在'
          break
        case 500:
          errorMessage = '服务器内部错误'
          break
        default:
          errorMessage = data.message || '网络错误'
      }
    } else if (error.request) {
      errorMessage = '网络连接失败'
    } else {
      errorMessage = error.message || '未知错误'
    }
    
    if (showMessage) {
      message.error(errorMessage)
    }
    
    // 记录错误日志
    console.error('API Error:', {
      error,
      message: errorMessage,
      timestamp: new Date().toISOString(),
    })
  }
}
```

#### 12.2.2 加载状态管理

```vue
<template>
  <div class="requirement-list">
    <!-- 骨架屏加载 -->
    <template v-if="loading">
      <a-skeleton
        v-for="i in 6"
        :key="i"
        :loading="true"
        :paragraph="{ rows: 3 }"
        class="mb-4"
      />
    </template>
    
    <!-- 空状态 -->
    <a-empty
      v-else-if="!requirements.length"
      description="暂无需求数据"
    >
      <template #image>
        <img src="/images/empty-requirements.svg" alt="暂无数据" />
      </template>
      <a-button type="primary" @click="handleCreate">
        创建需求
      </a-button>
    </a-empty>
    
    <!-- 数据列表 -->
    <template v-else>
      <RequirementCard
        v-for="item in requirements"
        :key="item.id"
        :data="item"
        @update="handleUpdate"
        @delete="handleDelete"
      />
    </template>
    
    <!-- 加载更多 -->
    <div v-if="hasMore" class="load-more">
      <a-button
        :loading="loadingMore"
        @click="loadMore"
      >
        加载更多
      </a-button>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, onMounted } from 'vue'
import { useInfiniteScroll } from '@vueuse/core'

const loading = ref(false)
const loadingMore = ref(false)
const requirements = ref<RequirementInfo[]>([])
const hasMore = ref(true)
const page = ref(1)

/**
 * 加载需求列表
 */
const loadRequirements = async (isLoadMore = false) => {
  if (isLoadMore) {
    loadingMore.value = true
  } else {
    loading.value = true
  }
  
  try {
    const result = await getRequirementListApi({
      page: page.value,
      pageSize: 20,
    })
    
    if (isLoadMore) {
      requirements.value.push(...result.items)
    } else {
      requirements.value = result.items
    }
    
    hasMore.value = result.items.length === 20
    page.value++
  } catch (error) {
    ApiErrorHandler.handle(error)
  } finally {
    loading.value = false
    loadingMore.value = false
  }
}

/**
 * 加载更多
 */
const loadMore = () => {
  loadRequirements(true)
}

// 无限滚动
const { isLoading } = useInfiniteScroll(
  document,
  () => {
    if (hasMore.value && !loadingMore.value) {
      loadMore()
    }
  },
  { distance: 100 }
)

onMounted(() => {
  loadRequirements()
})
</script>
```

### 12.4 测试规范

#### 12.4.1 单元测试

```typescript
// tests/components/RequirementCard.spec.ts
import { mount } from '@vue/test-utils'
import { describe, it, expect, vi } from 'vitest'
import RequirementCard from '/@/components/verto/RequirementCard.vue'
import type { RequirementInfo } from '/@/types/verto'

const mockRequirement: RequirementInfo = {
  id: '1',
  title: '测试需求',
  description: '这是一个测试需求',
  status: 'draft',
  priority: 'medium',
  assigneeId: 'user1',
  assigneeName: '张三',
  createTime: '2024-01-01 10:00:00',
  updateTime: '2024-01-01 10:00:00',
}

describe('RequirementCard', () => {
  it('应该正确渲染需求信息', () => {
    const wrapper = mount(RequirementCard, {
      props: {
        data: mockRequirement,
      },
    })
    
    expect(wrapper.find('.requirement-title').text()).toBe('测试需求')
    expect(wrapper.find('.requirement-assignee').text()).toContain('张三')
  })
  
  it('应该在点击编辑按钮时触发edit事件', async () => {
    const wrapper = mount(RequirementCard, {
      props: {
        data: mockRequirement,
      },
    })
    
    await wrapper.find('.edit-btn').trigger('click')
    
    expect(wrapper.emitted('edit')).toBeTruthy()
    expect(wrapper.emitted('edit')[0]).toEqual([mockRequirement])
  })
  
  it('应该根据状态显示正确的标签颜色', () => {
    const wrapper = mount(RequirementCard, {
      props: {
        data: { ...mockRequirement, status: 'completed' },
      },
    })
    
    const statusTag = wrapper.find('.status-tag')
    expect(statusTag.classes()).toContain('ant-tag-success')
  })
})
```

#### 12.4.2 集成测试

```typescript
// tests/views/RequirementList.spec.ts
import { mount } from '@vue/test-utils'
import { describe, it, expect, vi, beforeEach } from 'vitest'
import RequirementList from '/@/views/verto/requirements/index.vue'
import { getRequirementListApi } from '/@/api/verto/requirement'

// Mock API
vi.mock('/@/api/verto/requirement', () => ({
  getRequirementListApi: vi.fn(),
}))

const mockApiResponse = {
  items: [
    {
      id: '1',
      title: '需求1',
      status: 'draft',
      priority: 'high',
    },
    {
      id: '2',
      title: '需求2',
      status: 'in_progress',
      priority: 'medium',
    },
  ],
  total: 2,
  page: 1,
  pageSize: 20,
}

describe('RequirementList', () => {
  beforeEach(() => {
    vi.clearAllMocks()
  })
  
  it('应该在组件挂载时加载需求列表', async () => {
    vi.mocked(getRequirementListApi).mockResolvedValue(mockApiResponse)
    
    const wrapper = mount(RequirementList)
    
    // 等待异步操作完成
    await wrapper.vm.$nextTick()
    await new Promise(resolve => setTimeout(resolve, 0))
    
    expect(getRequirementListApi).toHaveBeenCalledTimes(1)
    expect(wrapper.findAll('.requirement-card')).toHaveLength(2)
  })
  
  it('应该在搜索时调用API并更新列表', async () => {
    vi.mocked(getRequirementListApi).mockResolvedValue(mockApiResponse)
    
    const wrapper = mount(RequirementList)
    
    // 模拟搜索
    const searchInput = wrapper.find('input[placeholder="请输入关键词"]')
    await searchInput.setValue('需求1')
    await searchInput.trigger('keyup.enter')
    
    expect(getRequirementListApi).toHaveBeenCalledWith({
      keyword: '需求1',
      page: 1,
      pageSize: 20,
    })
  })
})
```

### 12.5 部署和构建优化

#### 12.5.1 构建优化配置

```typescript
// vite.config.ts
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'
import { resolve } from 'path'
import { visualizer } from 'rollup-plugin-visualizer'
import { createHtmlPlugin } from 'vite-plugin-html'

export default defineConfig({
  plugins: [
    vue(),
    // HTML模板插件
    createHtmlPlugin({
      minify: true,
      inject: {
        data: {
          title: 'Verto - 企业级开发平台',
          description: '基于JeecgBoot的企业级开发平台',
        },
      },
    }),
    // 打包分析插件
    visualizer({
      filename: 'dist/stats.html',
      open: true,
      gzipSize: true,
    }),
  ],
  
  // 构建优化
  build: {
    // 代码分割
    rollupOptions: {
      output: {
        manualChunks: {
          // 第三方库单独打包
          vendor: ['vue', 'vue-router', 'pinia'],
          antd: ['ant-design-vue'],
          utils: ['lodash-es', 'dayjs'],
          // 业务模块分包
          verto: [
            'src/views/verto',
            'src/api/verto',
            'src/store/modules/verto',
          ],
        },
      },
    },
    
    // 压缩配置
    minify: 'terser',
    terserOptions: {
      compress: {
        drop_console: true,
        drop_debugger: true,
      },
    },
    
    // 资源内联阈值
    assetsInlineLimit: 4096,
    
    // 启用CSS代码分割
    cssCodeSplit: true,
  },
  
  // 开发服务器配置
  server: {
    port: 3000,
    open: true,
    cors: true,
    proxy: {
      '/api': {
        target: 'http://localhost:8080',
        changeOrigin: true,
        rewrite: (path) => path.replace(/^\/api/, ''),
      },
    },
  },
})
```

#### 12.5.2 PWA配置

```typescript
// vite-plugin-pwa配置
import { VitePWA } from 'vite-plugin-pwa'

export default defineConfig({
  plugins: [
    VitePWA({
      registerType: 'autoUpdate',
      workbox: {
        globPatterns: ['**/*.{js,css,html,ico,png,svg}'],
        runtimeCaching: [
          {
            urlPattern: /^https:\/\/api\.verto\.com\/.*/i,
            handler: 'CacheFirst',
            options: {
              cacheName: 'verto-api-cache',
              expiration: {
                maxEntries: 10,
                maxAgeSeconds: 60 * 60 * 24 * 365, // 1年
              },
              cacheKeyWillBeUsed: async ({ request }) => {
                return `${request.url}?version=1.0.0`
              },
            },
          },
        ],
      },
      manifest: {
        name: 'Verto企业级开发平台',
        short_name: 'Verto',
        description: '基于JeecgBoot的企业级开发平台',
        theme_color: '#1890ff',
        background_color: '#ffffff',
        display: 'standalone',
        icons: [
          {
            src: 'pwa-192x192.png',
            sizes: '192x192',
            type: 'image/png',
          },
          {
            src: 'pwa-512x512.png',
            sizes: '512x512',
            type: 'image/png',
          },
        ],
      },
    }),
  ],
})
```

## 总结

本前端组件设计文档基于JeecgBoot框架，为Verto平台提供了完整的前端架构设计方案。文档涵盖了：

1. **基础组件设计**：基于JeecgBoot的BasicTable、BasicForm等组件进行扩展
2. **业务组件设计**：针对需求、应用、物料、人员等业务场景的专用组件
3. **路由和状态管理**：使用Vue Router和Pinia进行应用状态管理
4. **API接口设计**：统一的API调用模式和错误处理机制
5. **配置化开发**：通过配置文件实现组件的快速复用和定制
6. **开发规范**：代码规范、性能优化、测试规范等最佳实践

通过遵循本文档的设计规范，开发团队可以高效地构建出功能完善、性能优良、易于维护的前端应用。

const statusColor = computed(() => {
  const colors = {
    draft: 'default',
    active: 'processing',
    testing: 'warning',
    closed: 'success'
  }
  return colors[props.requirement.status] || 'default'
})

const statusText = computed(() => {
  const texts = {
    draft: '草稿',
    active: '进行中',
    testing: '测试中',
    closed: '已完成'
  }
  return texts[props.requirement.status] || '未知'
})

const progressColor = computed(() => {
  const rate = props.requirement.completionRate
  if (rate >= 80) return '#52c41a'
  if (rate >= 50) return '#faad14'
  return '#ff4d4f'
})

const nextStatusText = computed(() => {
  const nextStatus = {
    draft: '开始',
    active: '测试',
    testing: '完成',
    closed: '重开'
  }
  return nextStatus[props.requirement.status] || '操作'
})

// 方法
const formatDate = (date: string) => {
  return dayjs(date).format('MM-DD')
}

const handleMenuClick = ({ key }: { key: string }) => {
  if (key === 'edit') {
    // 编辑逻辑
  } else if (key === 'delete') {
    emit('delete', props.requirement.id)
  }
}

const handleViewDetail = () => {
  emit('view-detail', props.requirement.id)
}

const handleStatusChange = () => {
  const nextStatus = {
    draft: 'active',
    active: 'testing',
    testing: 'closed',
    closed: 'active'
  }
  const newStatus = nextStatus[props.requirement.status]
  if (newStatus) {
    emit('status-change', props.requirement.id, newStatus)
  }
}
</script>

<style scoped>
.requirement-card {
  @apply bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-4 transition-all duration-200;
}

.requirement-card:hover {
  @apply shadow-md border-blue-300;
}

.requirement-card.draggable {
  @apply cursor-move;
}

.card-header {
  @apply flex justify-between items-start mb-3;
}

.card-title {
  @apply flex items-center gap-2 flex-1;
}

.card-content {
  @apply mb-4;
}

.description {
  @apply text-gray-600 mb-3;
}

.card-meta {
  @apply flex gap-4 text-sm text-gray-500;
}

.meta-item {
  @apply flex items-center gap-1;
}

.card-footer {
  @apply space-y-3;
}

.card-actions {
  @apply flex justify-between;
}

/* 状态样式 */
.status-draft {
  @apply border-l-4 border-l-gray-400;
}

.status-active {
  @apply border-l-4 border-l-blue-500;
}

.status-testing {
  @apply border-l-4 border-l-yellow-500;
}

.status-closed {
  @apply border-l-4 border-l-green-500;
}

/* 优先级样式 */
.priority-1 {
  @apply bg-red-50;
}

.priority-2 {
  @apply bg-yellow-50;
}

.priority-3 {
  @apply bg-gray-50;
}
</style>
```

### 2. 物料预览组件 (MaterialPreview)

**功能特性**:
- 支持代码预览
- 支持实时渲染
- 支持属性配置
- 支持代码复制

```vue
<template>
  <div class="material-preview">
    <a-tabs v-model:activeKey="activeTab" type="card">
      <a-tab-pane key="preview" tab="预览">
        <div class="preview-container">
          <div class="preview-toolbar">
            <a-space>
              <a-select v-model:value="selectedDevice" size="small">
                <a-select-option value="desktop">桌面端</a-select-option>
                <a-select-option value="tablet">平板</a-select-option>
                <a-select-option value="mobile">手机</a-select-option>
              </a-select>
              <a-button size="small" @click="refreshPreview">
                <ReloadOutlined />
              </a-button>
            </a-space>
          </div>
          
          <div class="preview-frame" :class="deviceClass">
            <iframe 
              ref="previewFrame"
              :src="previewUrl"
              frameborder="0"
              @load="handleFrameLoad"
            />
          </div>
        </div>
      </a-tab-pane>
      
      <a-tab-pane key="code" tab="代码">
        <div class="code-container">
          <div class="code-toolbar">
            <a-space>
              <a-select v-model:value="selectedLanguage" size="small">
                <a-select-option value="vue">Vue</a-select-option>
                <a-select-option value="react">React</a-select-option>
                <a-select-option value="html">HTML</a-select-option>
              </a-select>
              <a-button size="small" @click="copyCode">
                <CopyOutlined />
                复制代码
              </a-button>
            </a-space>
          </div>
          
          <MonacoEditor
            v-model="codeContent"
            :language="selectedLanguage"
            :options="editorOptions"
            height="400px"
          />
        </div>
      </a-tab-pane>
      
      <a-tab-pane key="props" tab="属性">
        <div class="props-container">
          <FormBuilder
            v-model="propsData"
            :schema="propsSchema"
            @change="handlePropsChange"
          />
        </div>
      </a-tab-pane>
    </a-tabs>
  </div>
</template>

<script setup lang="ts">
import { ref, computed, watch } from 'vue'
import { ReloadOutlined, CopyOutlined } from '@ant-design/icons-vue'
import MonacoEditor from '@/components/common/MonacoEditor.vue'
import FormBuilder from '@/components/common/FormBuilder.vue'
import type { Material } from '@/types/material'

interface Props {
  material: Material
}

const props = defineProps<Props>()

const activeTab = ref('preview')
const selectedDevice = ref('desktop')
const selectedLanguage = ref('vue')
const previewFrame = ref<HTMLIFrameElement>()
const propsData = ref({})

const deviceClass = computed(() => ({
  'device-desktop': selectedDevice.value === 'desktop',
  'device-tablet': selectedDevice.value === 'tablet',
  'device-mobile': selectedDevice.value === 'mobile'
}))

const previewUrl = computed(() => {
  const baseUrl = '/material-preview'
  const params = new URLSearchParams({
    id: props.material.id,
    props: JSON.stringify(propsData.value)
  })
  return `${baseUrl}?${params.toString()}`
})

const codeContent = computed(() => {
  return props.material.sourceCode || ''
})

const propsSchema = computed(() => {
  return props.material.propsSchema || { type: 'object', properties: {} }
})

const editorOptions = {
  readOnly: true,
  minimap: { enabled: false },
  scrollBeyondLastLine: false,
  theme: 'vs-dark'
}

// 方法
const refreshPreview = () => {
  if (previewFrame.value) {
    previewFrame.value.src = previewUrl.value
  }
}

const copyCode = async () => {
  try {
    await navigator.clipboard.writeText(codeContent.value)
    message.success('代码已复制到剪贴板')
  } catch (error) {
    message.error('复制失败')
  }
}

const handleFrameLoad = () => {
  // 预览加载完成
}

const handlePropsChange = () => {
  // 属性变更时刷新预览
  refreshPreview()
}

// 监听设备变化
watch(selectedDevice, () => {
  refreshPreview()
})
</script>

<style scoped>
.material-preview {
  @apply h-full;
}

.preview-container {
  @apply h-full flex flex-col;
}

.preview-toolbar {
  @apply p-3 border-b border-gray-200 bg-gray-50;
}

.preview-frame {
  @apply flex-1 bg-white relative overflow-hidden;
}

.preview-frame iframe {
  @apply w-full h-full;
}

.device-desktop .preview-frame iframe {
  @apply w-full h-full;
}

.device-tablet .preview-frame {
  @apply mx-auto;
  width: 768px;
  max-width: 100%;
}

.device-mobile .preview-frame {
  @apply mx-auto;
  width: 375px;
  max-width: 100%;
}

.code-container {
  @apply h-full flex flex-col;
}

.code-toolbar {
  @apply p-3 border-b border-gray-200 bg-gray-50;
}

.props-container {
  @apply p-4;
}
</style>
```

## 状态管理

### Pinia Store设计

```typescript
// stores/requirement.ts
import { defineStore } from 'pinia'
import type { Requirement, RequirementQuery } from '@/types/requirement'
import { requirementApi } from '@/api/requirement'

export const useRequirementStore = defineStore('requirement', () => {
  // 状态
  const requirements = ref<Requirement[]>([])
  const loading = ref(false)
  const pagination = ref({
    current: 1,
    pageSize: 10,
    total: 0
  })
  const filters = ref<RequirementQuery>({})
  
  // 计算属性
  const requirementMap = computed(() => {
    return requirements.value.reduce((map, item) => {
      map[item.id] = item
      return map
    }, {} as Record<string, Requirement>)
  })
  
  const statusStats = computed(() => {
    return requirements.value.reduce((stats, item) => {
      stats[item.status] = (stats[item.status] || 0) + 1
      return stats
    }, {} as Record<string, number>)
  })
  
  // 操作
  const fetchRequirements = async (query?: RequirementQuery) => {
    loading.value = true
    try {
      const params = { ...filters.value, ...query }
      const response = await requirementApi.getList(params)
      
      requirements.value = response.records
      pagination.value = {
        current: response.current,
        pageSize: response.size,
        total: response.total
      }
    } catch (error) {
      console.error('获取需求列表失败:', error)
    } finally {
      loading.value = false
    }
  }
  
  const createRequirement = async (data: Partial<Requirement>) => {
    try {
      const requirement = await requirementApi.create(data)
      requirements.value.unshift(requirement)
      return requirement
    } catch (error) {
      console.error('创建需求失败:', error)
      throw error
    }
  }
  
  const updateRequirement = async (id: string, data: Partial<Requirement>) => {
    try {
      const requirement = await requirementApi.update(id, data)
      const index = requirements.value.findIndex(item => item.id === id)
      if (index !== -1) {
        requirements.value[index] = requirement
      }
      return requirement
    } catch (error) {
      console.error('更新需求失败:', error)
      throw error
    }
  }
  
  const deleteRequirement = async (id: string) => {
    try {
      await requirementApi.delete(id)
      const index = requirements.value.findIndex(item => item.id === id)
      if (index !== -1) {
        requirements.value.splice(index, 1)
      }
    } catch (error) {
      console.error('删除需求失败:', error)
      throw error
    }
  }
  
  const updateFilters = (newFilters: Partial<RequirementQuery>) => {
    filters.value = { ...filters.value, ...newFilters }
  }
  
  const resetFilters = () => {
    filters.value = {}
  }
  
  return {
    // 状态
    requirements,
    loading,
    pagination,
    filters,
    
    // 计算属性
    requirementMap,
    statusStats,
    
    // 操作
    fetchRequirements,
    createRequirement,
    updateRequirement,
    deleteRequirement,
    updateFilters,
    resetFilters
  }
})
```

## 路由设计

```typescript
// router/index.ts
import { createRouter, createWebHistory } from 'vue-router'
import type { RouteRecordRaw } from 'vue-router'

const routes: RouteRecordRaw[] = [
  {
    path: '/',
    name: 'Layout',
    component: () => import('@/layouts/BasicLayout.vue'),
    redirect: '/dashboard',
    children: [
      {
        path: '/dashboard',
        name: 'Dashboard',
        component: () => import('@/views/dashboard/index.vue'),
        meta: {
          title: '仪表板',
          icon: 'DashboardOutlined',
          keepAlive: true
        }
      },
      {
        path: '/requirement',
        name: 'Requirement',
        component: () => import('@/views/requirement/index.vue'),
        meta: {
          title: '需求管理',
          icon: 'FileTextOutlined'
        },
        children: [
          {
            path: '',
            name: 'RequirementList',
            component: () => import('@/views/requirement/list.vue'),
            meta: { title: '需求列表' }
          },
          {
            path: 'create',
            name: 'RequirementCreate',
            component: () => import('@/views/requirement/form.vue'),
            meta: { title: '创建需求' }
          },
          {
            path: ':id',
            name: 'RequirementDetail',
            component: () => import('@/views/requirement/detail.vue'),
            meta: { title: '需求详情' }
          },
          {
            path: ':id/edit',
            name: 'RequirementEdit',
            component: () => import('@/views/requirement/form.vue'),
            meta: { title: '编辑需求' }
          }
        ]
      },
      {
        path: '/application',
        name: 'Application',
        component: () => import('@/views/application/index.vue'),
        meta: {
          title: '应用管理',
          icon: 'AppstoreOutlined'
        }
      },
      {
        path: '/material',
        name: 'Material',
        component: () => import('@/views/material/index.vue'),
        meta: {
          title: '物料管理',
          icon: 'BlockOutlined'
        }
      },
      {
        path: '/personnel',
        name: 'Personnel',
        component: () => import('@/views/personnel/index.vue'),
        meta: {
          title: '人员管理',
          icon: 'TeamOutlined'
        }
      },
      {
        path: '/project',
        name: 'Project',
        component: () => import('@/views/project/index.vue'),
        meta: {
          title: '项目管理',
          icon: 'ProjectOutlined'
        }
      }
    ]
  },
  {
    path: '/login',
    name: 'Login',
    component: () => import('@/views/auth/login.vue'),
    meta: {
      title: '登录',
      layout: false
    }
  },
  {
    path: '/:pathMatch(.*)*',
    name: 'NotFound',
    component: () => import('@/views/error/404.vue'),
    meta: {
      title: '页面不存在',
      layout: false
    }
  }
]

const router = createRouter({
  history: createWebHistory(),
  routes,
  scrollBehavior(to, from, savedPosition) {
    if (savedPosition) {
      return savedPosition
    } else {
      return { top: 0 }
    }
  }
})

// 路由守卫
router.beforeEach((to, from, next) => {
  // 设置页面标题
  if (to.meta.title) {
    document.title = `${to.meta.title} - 前端项目管理平台`
  }
  
  // 权限检查
  const token = localStorage.getItem('token')
  if (to.name !== 'Login' && !token) {
    next({ name: 'Login' })
  } else {
    next()
  }
})

export default router
```

## 样式规范

### 1. Tailwind CSS配置
```javascript
// tailwind.config.js
module.exports = {
  content: [
    './index.html',
    './src/**/*.{vue,js,ts,jsx,tsx}'
  ],
  theme: {
    extend: {
      colors: {
        primary: {
          50: '#f0f9ff',
          500: '#3b82f6',
          600: '#2563eb',
          700: '#1d4ed8'
        },
        gray: {
          50: '#f9fafb',
          100: '#f3f4f6',
          200: '#e5e7eb',
          300: '#d1d5db',
          400: '#9ca3af',
          500: '#6b7280',
          600: '#4b5563',
          700: '#374151',
          800: '#1f2937',
          900: '#111827'
        }
      },
      spacing: {
        '18': '4.5rem',
        '88': '22rem'
      },
      animation: {
        'fade-in': 'fadeIn 0.3s ease-in-out',
        'slide-up': 'slideUp 0.3s ease-out'
      }
    }
  },
  plugins: [
    require('@tailwindcss/forms'),
    require('@tailwindcss/typography')
  ]
}
```

### 2. CSS变量定义
```css
/* styles/variables.css */
:root {
  /* 颜色变量 */
  --color-primary: #1890ff;
  --color-success: #52c41a;
  --color-warning: #faad14;
  --color-error: #ff4d4f;
  --color-info: #1890ff;
  
  /* 间距变量 */
  --spacing-xs: 4px;
  --spacing-sm: 8px;
  --spacing-md: 16px;
  --spacing-lg: 24px;
  --spacing-xl: 32px;
  
  /* 字体变量 */
  --font-size-xs: 12px;
  --font-size-sm: 14px;
  --font-size-md: 16px;
  --font-size-lg: 18px;
  --font-size-xl: 20px;
  
  /* 阴影变量 */
  --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
  --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
  --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
  
  /* 圆角变量 */
  --border-radius-sm: 4px;
  --border-radius-md: 6px;
  --border-radius-lg: 8px;
  --border-radius-xl: 12px;
}
```

## 性能优化

### 1. 组件懒加载
```typescript
// 路由懒加载
const RequirementList = () => import('@/views/requirement/list.vue')

// 组件懒加载
const LazyComponent = defineAsyncComponent({
  loader: () => import('@/components/heavy/HeavyComponent.vue'),
  loadingComponent: LoadingComponent,
  errorComponent: ErrorComponent,
  delay: 200,
  timeout: 3000
})
```

### 2. 虚拟滚动
```vue
<template>
  <VirtualList
    :items="items"
    :item-height="60"
    :container-height="400"
    #default="{ item, index }"
  >
    <div class="list-item">
      {{ item.name }}
    </div>
  </VirtualList>
</template>
```

### 3. 组件缓存
```vue
<template>
  <router-view v-slot="{ Component }">
    <keep-alive :include="cachedViews">
      <component :is="Component" />
    </keep-alive>
  </router-view>
</template>
```

### 4. 防抖和节流
```typescript
// composables/useDebounce.ts
import { ref, watch } from 'vue'
import { debounce } from 'lodash-es'

export function useDebounce<T>(value: Ref<T>, delay: number) {
  const debouncedValue = ref(value.value)
  
  const updateDebouncedValue = debounce((newValue: T) => {
    debouncedValue.value = newValue
  }, delay)
  
  watch(value, updateDebouncedValue, { immediate: true })
  
  return debouncedValue
}
```

## 总结

本文档详细设计了前端项目管理平台的组件架构，包括：

1. **设计原则**: 组件化、数据流、性能等核心原则
2. **技术栈**: Vue3 + TypeScript + Vite + Ant Design Vue
3. **组件架构**: 分层设计，职责清晰
4. **核心组件**: DataTable、FormBuilder、SearchForm等通用组件
5. **业务组件**: RequirementCard、MaterialPreview等业务特定组件
6. **状态管理**: 基于Pinia的状态管理方案
7. **路由设计**: 嵌套路由和权限控制
8. **样式规范**: Tailwind CSS + CSS变量
9. **性能优化**: 懒加载、虚拟滚动、缓存等优化策略

这套设计方案确保了代码的可维护性、可扩展性和性能，为项目的长期发展奠定了坚实的基础。